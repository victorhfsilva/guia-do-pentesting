## Exploração de Vulnerabilidade SQL Injection com UNION

O uso do operador `UNION` em uma vulnerabilidade de SQL Injection (SQLi) é uma técnica avançada que permite a um invasor acessar dados de outras tabelas dentro do banco de dados. Esta técnica pode ser usada para combinar o resultado de duas ou mais consultas SQL e retornar dados de tabelas diferentes, contanto que algumas condições sejam satisfeitas.

### Como Funciona o SQL Injection com UNION

A exploração de SQLi com `UNION` envolve a inserção de uma consulta maliciosa que combina os resultados de duas consultas SQL diferentes. Isso é feito para extrair dados de tabelas que normalmente não seriam acessíveis pela aplicação.

**Exemplo de SQLi com UNION:**
```sql
SELECT name, description FROM products WHERE category = 'Gifts' 
UNION 
SELECT username, password FROM users --'
```
Neste exemplo, o invasor tenta acessar os nomes de usuário e senhas da tabela `users` enquanto visualiza os produtos da categoria "Gifts".

### Requisitos para Uso de UNION

Para que o ataque com `UNION` funcione corretamente, algumas condições devem ser atendidas:

1. **Número de Colunas**: As duas consultas unidas pelo `UNION` devem retornar o mesmo número de colunas. Se isso não acontecer, a consulta falhará.

2. **Compatibilidade de Tipos de Dados**: Os tipos de dados das colunas retornadas pelas consultas também devem ser compatíveis. Por exemplo, se a primeira coluna da primeira consulta retorna um texto, a primeira coluna da segunda consulta também deve retornar um texto (ou algo compatível).

### Determinando o Número de Colunas

Antes de executar o ataque com `UNION`, é necessário descobrir o número de colunas que a consulta original está retornando. Isso pode ser feito usando a cláusula `ORDER BY`.

**Exemplo:**
```sql
' ORDER BY 1--
' ORDER BY 2--
' ORDER BY 3--
```

Aqui, o invasor incrementa o número de colunas no `ORDER BY` até que a aplicação retorne um erro. O número máximo que não causa erro indica o número de colunas na consulta original.

Outra maneira de determinar o número de colunas é usando `UNION SELECT NULL`:

**Exemplo:**
```sql
' UNION SELECT NULL--
' UNION SELECT NULL, NULL--
' UNION SELECT NULL, NULL, NULL--
```

Cada vez que a consulta é executada, o invasor adiciona mais `NULL`s até que a consulta seja bem-sucedida. Quando a consulta é bem-sucedida, o número de `NULL`s corresponde ao número de colunas da consulta original.

### Explorando Tipos de Colunas

Depois de determinar o número de colunas, o invasor pode tentar encontrar colunas específicas que correspondam a tipos de dados específicos (por exemplo, texto).

**Exemplo:**
```sql
' UNION SELECT 'a', NULL, NULL, NULL--
' UNION SELECT NULL, 'a', NULL, NULL--
' UNION SELECT NULL, NULL, 'a', NULL--
' UNION SELECT NULL, NULL, NULL, 'a'--
```
O objetivo aqui é testar cada coluna individualmente até que a consulta seja bem-sucedida, indicando que a coluna em questão aceita o tipo de dado injetado (neste caso, texto).

### Considerações Específicas para Oracle

Em bancos de dados Oracle, todas as consultas `SELECT` devem conter a cláusula `FROM`. Portanto, ao explorar vulnerabilidades em Oracle, o invasor precisará ajustar as consultas injetadas:

**Exemplo:**
```sql
' UNION SELECT NULL FROM DUAL--
```

A tabela `DUAL` é uma tabela especial em Oracle usada para garantir que a consulta tenha um `FROM`, mesmo que não haja uma tabela específica envolvida.

### Exemplo Completo de Exploração

1. **Descubra o número de colunas:**
   ```sql
   ' UNION SELECT NULL, NULL, NULL FROM DUAL--
   ```
   Supondo que a consulta original tenha 3 colunas, esta consulta não causará erro.

2. **Teste tipos de colunas:**
   ```sql
   ' UNION SELECT 'a', NULL, NULL FROM DUAL--
   ```
   Se esta consulta for bem-sucedida, a primeira coluna aceita texto.

3. **Extraia dados sensíveis:**
   ```sql
   ' UNION SELECT username, password, NULL FROM users--
   ```
   Esta consulta extrairá os nomes de usuário e senhas da tabela `users`, se as colunas forem compatíveis.

