# **Attack Surface Detector CLI**

## Introdução

O **Attack Surface Detector (ASD) CLI** é uma ferramenta de linha de comando projetada para identificar e mapear a superfície de ataque de aplicações web ao analisar o código-fonte. Ele é capaz de descobrir **endpoints**, os **parâmetros** que esses endpoints aceitam e os **tipos de dados** desses parâmetros, incluindo **endpoints não vinculados** e **parâmetros opcionais** que podem não ser detectados por rastreadores tradicionais (spiders).

Além disso, o ASD CLI pode calcular a diferença na superfície de ataque entre duas versões de uma aplicação, o que é útil para verificar as mudanças de segurança ao longo do tempo. Esta ferramenta está disponível como um **plugin para as ferramentas ZAP e Burp Suite** e também como uma **ferramenta de linha de comando (CLI)** que gera relatórios em formato **JSON**.

O ASD CLI é extremamente útil quando o código-fonte de uma aplicação não está disponível diretamente para o pentester, já que o cliente pode fornecer apenas o arquivo JSON gerado pela ferramenta, preservando a privacidade do código.

## Funcionalidades Principais

- **Identificação de Endpoints**: Detecta endpoints expostos pela aplicação a partir do código-fonte, incluindo endpoints não documentados ou não utilizados no lado do cliente.
- **Análise de Parâmetros**: Verifica os parâmetros aceitos por cada endpoint e identifica seus tipos de dados (como `string`, `integer`, etc.).
- **Comparação de Versões**: Calcula as mudanças na superfície de ataque entre diferentes versões de uma aplicação.
- **Integração com Ferramentas de Segurança**: O ASD CLI gera um arquivo JSON que pode ser utilizado pelos plugins do **OWASP ZAP** e **Burp Suite**.
- **Automatização para Pentests**: Automatiza a detecção de áreas vulneráveis e a geração de relatórios, facilitando a análise em auditorias de segurança.

## Instalação do Attack Surface Detector CLI

### Pré-requisitos

- **Java** 8 ou superior instalado.
- **Git** instalado (se você for clonar o repositório).

### Baixando o ASD CLI

Você pode baixar a versão mais recente do ASD CLI diretamente do GitHub. A versão mais estável pode ser encontrada no [repositório de releases](https://github.com/secdec/attack-surface-detector-cli/releases).

Exemplo para baixar a versão 1.3.5:

```bash
wget https://github.com/secdec/attack-surface-detector-cli/releases/download/v1.3.5/attack-surface-detector-cli-1.3.5.jar
```

### Verificando a Instalação

Para verificar se o ASD CLI foi baixado corretamente, você pode executar o seguinte comando:

```bash
java -jar attack-surface-detector-cli-1.3.5.jar --help
```

Se o comando mostrar as opções da ferramenta, a instalação foi bem-sucedida.

## Uso Básico do Attack Surface Detector CLI

A sintaxe básica do comando ASD CLI é:

```bash
java -jar attack-surface-detector-cli-1.3.5.jar <caminho_do_codigo_fonte> [opções]
```

Esse comando inicia a detecção de endpoints e parâmetros do código-fonte localizado no `<caminho_do_codigo_fonte>`.

### Exemplo de Análise Simples

```bash
java -jar attack-surface-detector-cli-1.3.5.jar ./meu_projeto/
```

Esse comando executa a análise do código-fonte na pasta `./meu_projeto/`, identificando endpoints e parâmetros e gerando a saída diretamente no terminal.

## Analisando a Superfície de Ataque de uma Aplicação Web

Aqui está um exemplo real de como usar o ASD CLI para analisar uma aplicação, neste caso, o OWASP **RailsGoat**:

```bash
java -jar attack-surface-detector-cli-1.3.5.jar railsgoat/
```
#### Exemplo de Saída:

```plaintext
$ java -jar attack-surface-detector-cli-1.3.5.jar railsgoat/
Beginning endpoint detection for '<...>/railsgoat' with 1 framework types
Using framework=RAILS
[0] GET: /login (0 variants): PARAMETERS={url=name=url, paramType=QUERY_STRING, dataType=STRING}; FILE=/app/controllers/sessions_controller.rb (lines '6'-'9')
[1] GET: /logout (0 variants): PARAMETERS={}; FILE=/app/controllers/sessions_controller.rb (lines '33'-'37')
[2] POST: /forgot_password (0 variants): PARAMETERS={email=name=email, paramType=QUERY_STRING, dataType=STRING}; FILE=/app/controllers/
password_resets_controller.rb (lines '29'-'38')
[3] GET: /password_resets (0 variants): PARAMETERS={token=name=token, paramType=QUERY_STRING, dataType=STRING}; FILE=/app/controllers/p
assword_resets_controller.rb (lines '19'-'27')
[4] POST: /password_resets (0 variants): PARAMETERS={password=name=password, paramType=QUERY_STRING, dataType=STRING, user=name=user, paramType=QUERY_STRING, dataType=STRING, confirm_password=name=confirm_password, paramType=QUERY_STRING, dataType=STRING}; FILE=/app/controllers/password_resets_controller.rb (lines '5'-'17')
[5] GET: /sessions/new (0 variants): PARAMETERS={url=name=url, paramType=QUERY_STRING, dataType=STRING}; FILE=/app/controllers/sessions_controller.rb (lines '6'-'9')
[6] POST: /sessions (0 variants): PARAMETERS={password=name=password, paramType=QUERY_STRING, dataType=STRING, user_id=name=user_id, paramType=SESSION, dataType=STRING, remember_me=name=remember_me, paramType=QUERY_STRING, dataType=STRING, url=name=url, paramType=QUERY_STRING, dataType=STRING, email=name=email, paramType=QUERY_STRING, dataType=STRING}; FILE=/app/controllers/sessions_controller.rb (lines '11'-'31')
[7] DELETE: /sessions/{id} (0 variants): PARAMETERS={}; FILE=/app/controllers/sessions_controller.rb (lines '33'-'37')
[8] GET: /users (0 variants): PARAMETERS={}; FILE=/app/controllers/api/v1/users_controller.rb (lines '9'-'11')
[9] GET: /users/{id} (0 variants): PARAMETERS={}; FILE=/app/controllers/api/v1/users_controller.rb (lines '13'-'15')
... snipped ...
[38] GET: /api/v1/mobile/{id} (0 variants): PARAMETERS={id=name=id, paramType=QUERY_STRING, dataType=STRING, class=name=class, paramType=QUERY_STRING, dataType=STRING}; FILE=/app/controllers/api/v1/mobile_controller.rb (lines '8'-'13')
[39] GET: / (0 variants): PARAMETERS={url=name=url, paramType=QUERY_STRING, dataType=STRING}; FILE=/app/controllers/sessions_controller.rb (lines '6'-'9')
Generated 40 distinct endpoints with 0 variants for a total of 40 endpoints
Successfully validated serialization for these endpoints
0 endpoints were missing code start line
0 endpoints were missing code end line
0 endpoints had the same code start and end line
Generated 36 distinct parameters
Generated 36 total parameters
- 36/36 have their data type
- 0/36 have a list of accepted values
- 36/36 have their parameter type
--- QUERY_STRING: 35
--- SESSION: 1
Finished endpoint detection for '<...>/railsgoat'
----------
-- DONE --
0 projects had duplicate endpoints
Generated 40 distinct endpoints
Generated 40 total endpoints
Generated 36 distinct parameters
Generated 36 total parameters
1/1 projects had endpoints generated
To enable logging include the -debug argument
```


Essa saída mostra todos os endpoints detectados, incluindo informações sobre o método HTTP, os parâmetros aceitos, o tipo de parâmetro e o tipo de dado. Além disso, ela também indica os arquivos e as linhas de código onde esses endpoints foram encontrados.

### Gerando Saída em Formato JSON

O ASD CLI permite gerar um arquivo **JSON** que pode ser utilizado por plugins de ferramentas como **ZAP** e **Burp Suite**. Isso facilita a integração em fluxos de trabalho de pentest e auditorias.

```bash
java -jar attack-surface-detector-cli-1.3.5.jar railsgoat/ -json surface_report.json
```

Neste exemplo, o relatório da superfície de ataque será salvo no arquivo `surface_report.json`.

## Integração com ZAP e Burp Suite

O **Attack Surface Detector** pode ser integrado com ferramentas como **OWASP ZAP** e **Burp Suite**, permitindo que os resultados da análise de código sejam usados diretamente nessas ferramentas de pentest. Isso é útil, por exemplo, quando o código-fonte da aplicação não é fornecido diretamente para o pentester.

1. **Gerar o arquivo JSON**:
   ```bash
   java -jar attack-surface-detector-cli-1.3.5.jar ./meu_projeto/ --json surface_report.json
   ```

2. **Carregar o arquivo JSON no ZAP ou Burp Suite**: Use os plugins disponíveis para importar o relatório JSON e complementar os testes de segurança dinâmicos com os dados de análise estática.
