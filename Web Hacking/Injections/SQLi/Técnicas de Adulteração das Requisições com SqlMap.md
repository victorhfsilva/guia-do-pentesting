# Técnicas de Adulteração das Requisições do SQLmap

O SQLmap é uma ferramenta poderosa para detectar e explorar vulnerabilidades de SQL Injection. Para contornar proteções de segurança como WAFs (Web Application Firewalls) ou filtros de entrada, SQLmap inclui scripts de tamper que modificam as consultas SQL enviadas para o servidor. Estes scripts podem alterar a forma como as consultas são apresentadas, codificadas ou estruturadas, tornando-as mais difíceis de serem detectadas ou bloqueadas. Abaixo, estão algumas das técnicas de tamper disponíveis no SQLmap, com explicações e exemplos de uso.

## **apostrophemask.py**

### Função

Codifica aspas simples (`'`) em UTF-8, para evitar a detecção por WAFs que analisam aspas simples em consultas SQL.

### Plataforma

Todas

### Exemplo

```sql
1 AND '1'='1' ==> 1 AND %EF%BC%871%EF%BC%87=%EF%BC%871
```

### Explicação

Essa técnica substitui as aspas simples por sua codificação UTF-8, que é mais difícil de ser detectada por filtros básicos.

## **apostrophenullencode.py**

### Função

Substitui aspas simples (`'`) pela sequência `%00%27`.

### Plataforma

Todas

### Exemplo

```sql
1 AND '1'='1' ==> 1 AND %00%271%00%27=%00%271
```

### Explicação

Isso adiciona um byte nulo (`%00`) antes da aspa simples, o que pode contornar alguns mecanismos de filtragem que não tratam corretamente o byte nulo.

## **appendnullbyte.py**

### Função

Adiciona um byte nulo (`%00`) ao final da consulta.

### Plataforma

Microsoft Access

### Exemplo

```sql
1 AND 1=1 ==> 1 AND 1=1%00
```

### Explicação

Essa técnica pode ser usada para enganar mecanismos de segurança que não interpretam corretamente o byte nulo, permitindo que a injeção passe despercebida.

## **base64encode.py**

### Função

Codifica a consulta SQL em Base64.

### Plataforma

Todas

### Exemplo

```sql
1' AND SLEEP(5)# ==> MScgQU5EIFNMRUVQKDUpIw==
```

### Explicação

Codifica a consulta inteira em Base64, o que pode ser útil para passar por mecanismos de segurança que não analisam conteúdo codificado.

## **between.py**

### Função

Substitui o operador `>` por `NOT BETWEEN 0 AND`.

### Plataforma

MSSQL 2005, MySQL 4, 5.0 e 5.5, Oracle 10g, PostgreSQL 8.3, 8.4, 9.0

### Exemplo

```sql
1 AND A > B ==> 1 AND A NOT BETWEEN 0 AND B
```

### Explicação

Esta técnica altera a comparação de `>` para um intervalo `NOT BETWEEN`, o que pode ajudar a contornar certos filtros de segurança.

## **bluecoat.py**

### Função

Substitui espaços (` `) por tabulações (`%09`).

### Plataforma

MySQL 5.1, SGOS

### Exemplo

```sql
SELECT id FROM users WHERE id = 1 ==> SELECT%09id FROM%09users WHERE%09id LIKE 1
```

### Explicação

Alguns mecanismos de filtragem podem não considerar tabulações (`%09`) como delimitadores de palavras, permitindo que a consulta passe sem ser detectada.

## **chardoubleencode.py**

### Função

Aplica codificação dupla aos caracteres da consulta.

### Plataforma

Todas

### Exemplo

```sql
SELECT FIELD FROM TABLE ==> %2553%2545%254C%2545%2543%2554%2520%2546%2549%2545%254C%2544%2520%2546%2552%254F%254D%2520%2554%2541%2542%254C%2545
```

### Explicação

Essa técnica codifica duas vezes a consulta SQL, dificultando a detecção por filtros que buscam padrões codificados.

## **charencode.py**

### Função

Codifica a consulta SQL usando URL encoding.

### Plataforma

MSSQL 2005, MySQL 4, 5.0 e 5.5, Oracle 10g, PostgreSQL 8.3, 8.4, 9.0

### Exemplo

```sql
SELECT FIELD FROM TABLE ==> %53%45%4C%45%43%54%20%46%49%45%4C%44%20%46%52%4F%4D%20%54%41%42%4C%45
```

### Explicação

Transforma os caracteres da consulta em suas representações URL encoded, o que pode contornar a detecção por filtros que não decodificam URLs corretamente.

## **charunicodeencode.py**

### Função

Codifica a consulta usando caracteres unicode.

### Plataforma

MSSQL 2000, 2005, MySQL 5.1.56, PostgreSQL 9.0.3, ASP/ASP.NET

### Exemplo

```sql
SELECT FIELD FROM TABLE ==> %u0053%u0045%u004C%u0045%u0043%u0054%u0020%u0046%u0049%u0045%u004C%u0044%u0020%u0046%u0052%u004F%u004D%u0020%u0054%u0041%u0042%u004C%u0045
```

### Explicação

Usa códigos de escape unicode para representar a consulta, o que pode confundir mecanismos de segurança que não processam corretamente esse tipo de codificação.

## **commalesslimit.py**

### Função

Substitui `LIMIT X, Y` por `LIMIT Y OFFSET X`.

### Plataforma

MySQL 5.0 e 5.5

### Exemplo

```sql
LIMIT 2, 3 ==> LIMIT 3 OFFSET 2
```

### Explicação

Altera a sintaxe do limite para usar `OFFSET`, que pode não ser reconhecido por certos mecanismos de filtragem que esperam a forma padrão `LIMIT X, Y`.

## **concat2concatws.py**

### Função

Substitui `CONCAT()` por `CONCAT_WS()`.

### Plataforma

MySQL 5.0

### Exemplo

```sql
CONCAT(1,2) ==> CONCAT_WS(MID(CHAR(0),0,0),1,2)
```

### Explicação

Modifica a função de concatenação, dificultando a detecção de padrões que buscam `CONCAT()` especificamente.

## **equaltolike.py**

### Função

Substitui `=` por `LIKE`.

### Plataforma

MSSQL 2005, MySQL 4, 5.0 e 5.5

### Exemplo

```sql
SELECT * FROM users WHERE id=1 ==> SELECT * FROM users WHERE id LIKE 1
```

### Explicação

Essa técnica substitui o operador de igualdade `=` por `LIKE`, o que pode contornar filtros que monitoram especificamente o uso de `=`.

## **escapequotes.py**

### Função

Escapa aspas simples (`'`) e aspas duplas (`"`).

### Plataforma

Todas

### Exemplo

```sql
1" AND SLEEP(5)# ==> 1\\\\" AND SLEEP(5)#
```

### Explicação

Essa técnica adiciona barras invertidas (`\`) antes de aspas, que pode contornar mecanismos de filtragem que não tratam corretamente caracteres de escape.

## **greatest.py**

### Função

Substitui `>` por `GREATEST()`.

### Plataforma

MySQL 4, 5.0 e 5.5, Oracle 10g, PostgreSQL 8.3, 8.4, 9.0

### Exemplo

```sql
1 AND A > B ==> 1 AND GREATEST(A,B+1)=A
```

### Explicação

Modifica a comparação para usar a função `GREATEST()`, que pode não ser filtrada ou bloqueada por certos mecanismos de segurança.

## **halfversionedmorekeywords.py**

### Função

Substitui espaços por `/*!0`.

### Plataforma

MySQL 4.0.18, 5.0.22

### Exemplo

```sql
union ==> /*!0union
```

### Explicação

Essa técnica insere um comentário com `/*!0` antes de palavras-chave como `UNION`, dificultando a detecção de consultas SQL maliciosas.

## Conclusão

Os scripts de tamper do SQLmap são ferramentas essenciais para contornar proteções em aplicações web, como WAFs e filtros de entrada. Cada técnica de tamper modifica a consulta SQL de maneira a dificultar a detecção e o bloqueio, permitindo que o SQLmap execute sua exploração de maneira mais eficaz. É importante conhecer e compreender essas técnicas para maximizar a eficácia dos testes de penetração e para desenvolver contramedidas eficazes contra ataques SQL Injection.