# SQLmap

## Introdução

SQLmap é uma ferramenta de código aberto usada para automatizar o processo de detecção e exploração de vulnerabilidades de SQL Injection (SQLi) em aplicações web. Ela pode identificar e explorar diferentes tipos de bancos de dados, permitindo a extração de dados, o envio de comandos SQL e até a obtenção de controle completo sobre o servidor. 

## Instalação

### Instalação no Kali Linux

No Kali Linux, o SQLmap já vem pré-instalado. Caso não esteja instalado, você pode usar:

```bash
sudo apt-get update
sudo apt-get install sqlmap
```

### Instalação em Outros Sistemas Linux

Em outras distribuições Linux, você pode instalar SQLmap usando pip:

```bash
sudo apt-get update
sudo apt-get install python3-pip
pip3 install sqlmap
```

### Instalação via Git

Para instalar diretamente do repositório Git:

```bash
git clone https://github.com/sqlmapproject/sqlmap.git
cd sqlmap
```

## Conceitos Básicos

SQLmap funciona identificando pontos de entrada vulneráveis em aplicações web e automatizando o processo de injeção SQL para extrair informações ou comprometer o banco de dados. Ele suporta uma ampla gama de bancos de dados, como MySQL, PostgreSQL, Oracle, MSSQL, entre outros.

## Comandos Básicos

### Estrutura do Comando

A estrutura básica de um comando SQLmap é:

```bash
sqlmap -u URL [opções]
```

### Parâmetros Comuns

#### -u

Define a URL alvo para a varredura.

```bash
sqlmap -u "http://example.com/index.php?id=1"
```

#### --data

Especifica dados para uma requisição POST.

```bash
sqlmap -u "http://example.com/login.php" --data "username=admin&password=123"
```

#### -p

Especifica o parâmetro a ser testado para SQL Injection.

```bash
sqlmap -u "http://example.com/index.php?id=1" -p id
```

#### --dbs

Enumera os bancos de dados no servidor alvo.

```bash
sqlmap -u "http://example.com/index.php?id=1" --dbs
```

#### --tables

Enumera as tabelas em um banco de dados específico.

```bash
sqlmap -u "http://example.com/index.php?id=1" -D nome_do_banco --tables
```

#### --columns

Enumera as colunas de uma tabela específica.

```bash
sqlmap -u "http://example.com/index.php?id=1" -D nome_do_banco -T nome_da_tabela --columns
```

#### --dump

Extrai o conteúdo de uma tabela específica.

```bash
sqlmap -u "http://example.com/index.php?id=1" -D nome_do_banco -T nome_da_tabela --dump
```

#### --all

Extrai todas as informações possíveis do banco de dados.

```bash
sqlmap -u "http://example.com/index.php?id=1" --all
```

#### --batch

Através desse comando é possível ignorar inputs do usuário e sempre utilizar valores padrão, muito útil em automações.

```bash
sqlmap -u "http://example.com/index.php?id=1" --batch
```

#### --delay

O parâmetro delay determina o delay entre requisições em segundos.

```bash
sqlmap -u "http://example.com/index.php?id=1" --delay=5
```

#### --level

Determina o level dos testes sendo 1 o mais leve e 5 o mais completo.

```bash
sqlmap -u "http://example.com/index.php?id=1" --level=5
```

#### --risk

Determina o o risco sendo 1 o mais inofensivo e 3 o mais perigoso.

```bash
sqlmap -u "http://example.com/index.php?id=1" --risk=1
```

## Fuzzing Avançado e Exploração

### Bypass de WAF (Web Application Firewall)

Para tentar contornar filtros de WAFs use o parâmetro tamper. Mais informações em [Técnicas de Adulteração das Requisições com Sqlmap](Técnicas%20de%20Adulteração%20das%20Requisições%20com%20SqlMap.md).

```bash
sqlmap -u "http://example.com/index.php?id=1" --random-agent --tamper=space2comment
```

Para listar todas as técnicas de adulteração:

```bash
sqlmap -list-tampers
```

### Acesso a Shell no Banco de Dados

Se o banco de dados permitir. SQLmap pode fornecer uma shell interativa no banco de dados para execução de comandos SQL diretamente:

```bash
sqlmap -u "http://example.com/index.php?id=1" --sql-shell
```

### Execução de Comandos no Sistema Operacional

Se o banco de dados permitir, SQLmap pode executar comandos no sistema operacional:

```bash
sqlmap -u "http://example.com/index.php?id=1" --os-shell
```

### Especificando Técnicas de Injeção

SQLmap permite especificar diferentes técnicas de injeção SQL com o parâmetro technique. Mais informações em [Técnicas de Injeção do SqlMap](Técnicas%20de%20Injeção%20do%20SqlMap.md)

```bash
sqlmap -u "http://example.com/index.php?id=1" --technique=U
```

### Configurações de Proxy

Se você precisar usar SQLmap através de um proxy:

```bash
sqlmap -u "http://example.com/index.php?id=1" --proxy="http://127.0.0.1:8080"
```

### Relatórios

SQLmap pode gerar relatórios detalhados em diferentes formatos (TXT, HTML, XML). Para especificar o diretório dos relatórios basta usar o parâmetro output-dir:

```bash
sqlmap -u "http://example.com/index.php?id=1" --output-dir=/tmp/sqlmap_reports
```

### Tor

Para usar uma rede tor nas requisições, primeiramente instale o pacote tor:

```bash
sudo apt install tor
```

Em seguida utilize os parâmetros tor e check-tor para verificar se a conexão tor foi bem sucedida. 

```bash
sqlmap -u http://example.com/index.php?id=1 --random-agent --tor --tor-port=9050 --check-tor
```


### Especificando parâmetros da requisição

O parâmetro `-r` no SQLmap é utilizado para indicar um arquivo que contém a requisição HTTP completa a ser utilizada na exploração. Esse arquivo pode incluir informações como cabeçalhos HTTP, dados de POST, cookies e outros parâmetros específicos da requisição. Esse método é especialmente útil quando você deseja replicar uma requisição específica que foi capturada, por exemplo, em ferramentas de interceptação de tráfego como o Burp Suite ou OWASP ZAP.

#### Exemplo de Uso

1. **Captura da Requisição**: Primeiro, capture a requisição HTTP que deseja testar. Você pode fazer isso usando uma ferramenta como o Burp Suite, que permite interceptar e salvar requisições. Salve a requisição em um arquivo de texto, por exemplo, `request.txt`.

   Exemplo de conteúdo de `request.txt`:

   ```
   POST /login.php HTTP/1.1
   Host: example.com
   User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36
   Content-Type: application/x-www-form-urlencoded
   Content-Length: 29

   username=admin&password=123
   ```

2. **Executando o SQLmap com o Parâmetro `-r`**: Com a requisição salva, você pode utilizar o SQLmap para realizar os testes de injeção SQL usando essa requisição específica.

   ```bash
   sqlmap -r request.txt --dbs
   ```

   Neste comando:
   - `-r request.txt`: Especifica o arquivo contendo a requisição HTTP.
   - `--dbs`: Instrui o SQLmap a enumerar os bancos de dados disponíveis no servidor alvo.

3. **Ajustes e Opções Adicionais**: Você pode combinar o parâmetro `-r` com outras opções do SQLmap, como `--level`, `--risk`, `--batch`, entre outras, para controlar a intensidade dos testes e automatizar o processo.

   Exemplo com parâmetros adicionais:

   ```bash
   sqlmap -r request.txt --dbs --level=5 --risk=3 --batch
   ```

   Nesse caso, estamos realizando um teste mais profundo (`--level=5`) e assumindo maior risco (`--risk=3`), além de automatizar respostas com `--batch`.

O uso do parâmetro `-r` é particularmente valioso quando você está lidando com requisições complexas, onde simplesmente fornecer a URL pode não ser suficiente para replicar o cenário real que você deseja testar. Além disso, ele ajuda a garantir que o SQLmap utiliza exatamente a mesma requisição que seria enviada por um navegador ou outra ferramenta, aumentando a precisão dos testes.

### Second URL

O parâmetro `--second-url` no SQLmap é utilizado para especificar uma URL alternativa que será requisitada após a exploração da URL principal. Este recurso é útil em cenários onde a exploração inicial desencadeia uma segunda requisição, como em casos onde um token de segurança precisa ser validado em outra URL.

#### Exemplo de Uso

Suponha que após enviar uma requisição para a URL principal, uma segunda requisição seja necessária para validar ou confirmar a ação. Você pode utilizar o SQLmap da seguinte forma:

```bash
sqlmap -u "http://example.com/index.php?id=1" --second-url="http://example.com/validate.php?token=123"
```

Neste comando:
- `-u "http://example.com/index.php?id=1"`: Especifica a URL principal que está sendo testada.
- `--second-url="http://example.com/validate.php?token=123"`: Define a URL secundária que será requisitada após a exploração da URL principal.

O uso de `--second-url` é importante quando o fluxo de validação de segurança de uma aplicação web exige múltiplas requisições, permitindo que o SQLmap siga corretamente a lógica da aplicação e explore possíveis vulnerabilidades.