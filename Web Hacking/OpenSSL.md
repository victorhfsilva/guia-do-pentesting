# **OpenSSL**

## Introdução

**OpenSSL** é uma poderosa biblioteca de criptografia de código aberto amplamente utilizada para proteger dados em trânsito e em repouso. Ela oferece uma série de funcionalidades relacionadas a protocolos de segurança, como SSL (Secure Sockets Layer) e TLS (Transport Layer Security), e também é usada para gerar chaves criptográficas, certificados, hashes, e muito mais.

OpenSSL é uma ferramenta essencial para administradores de sistemas, desenvolvedores, e profissionais de segurança, sendo utilizada em uma ampla gama de aplicativos e sistemas para criptografia de comunicações seguras, geração de certificados digitais, e manutenção de integridade de dados.

## Características do OpenSSL

- **Criação e Gerenciamento de Certificados**: Geração de certificados X.509, criação de Certificados Autoridade (CA) e gerenciamento de cadeias de confiança.
- **Criptografia e Decriptação**: Suporte para diversos algoritmos de criptografia simétrica e assimétrica, incluindo AES, RSA, DES, e ECC.
- **Assinatura Digital e Verificação**: Criação e validação de assinaturas digitais para garantir a integridade e autenticidade de dados.
- **Geração de Chaves**: Criação de chaves públicas e privadas para criptografia e autenticação.
- **Cálculo de Hashes**: Suporte para algoritmos de hash como SHA-1, SHA-256, MD5, entre outros.
- **Protocolo TLS/SSL**: Implementação de protocolos SSL e TLS para comunicações seguras na web.

## Uso Básico do OpenSSL

O OpenSSL é uma ferramenta de linha de comando extremamente versátil, com suporte para muitas operações relacionadas à criptografia. A seguir, cobriremos os usos mais comuns.

### Geração de Certificados SSL/TLS

Um dos usos mais comuns do OpenSSL é a criação de certificados SSL/TLS. Para criar um certificado autoassinado, você precisará gerar uma chave privada e, em seguida, o certificado.

#### Gerando uma Chave Privada

O primeiro passo é gerar uma chave privada que será utilizada para criar o certificado:

```bash
openssl genpkey -algorithm RSA -out private.key -aes256
```

**Explicação:**

- **`genpkey -algorithm RSA`**: Especifica o algoritmo RSA para a chave.
- **`-out private.key`**: Define o nome do arquivo da chave privada.
- **`-aes256`**: Criptografa a chave privada com o algoritmo AES-256.

#### Gerando um Certificado Autoassinado

Depois de gerar a chave privada, crie um certificado autoassinado (válido por 365 dias) usando essa chave:

```bash
openssl req -new -x509 -key private.key -out certificate.crt -days 365
```

**Explicação:**

- **`req -new -x509`**: Gera um novo certificado X.509.
- **`-key private.key`**: Usa a chave privada gerada anteriormente.
- **`-out certificate.crt`**: Nome do arquivo de saída do certificado.
- **`-days 365`**: Define o período de validade do certificado.

Durante a geração do certificado, você será solicitado a preencher alguns campos, como o nome comum (CN), que geralmente é o nome de domínio para o qual o certificado será usado.

### Verificação de Certificados

Você pode verificar os detalhes de um certificado usando o OpenSSL com o seguinte comando:

```bash
openssl x509 -in certificate.crt -text -noout
```

Isso exibirá as informações detalhadas do certificado, incluindo datas de validade, assinaturas e a autoridade certificadora (CA).

### Criação de Requisição de Assinatura de Certificado (CSR)

Se você precisar solicitar um certificado de uma Autoridade Certificadora (CA), o primeiro passo é criar uma **CSR (Certificate Signing Request)**:

```bash
openssl req -new -key private.key -out request.csr
```

**Explicação:**

- **`req -new`**: Gera uma nova requisição de assinatura de certificado.
- **`-key private.key`**: Usa a chave privada para gerar a CSR.
- **`-out request.csr`**: Especifica o arquivo de saída para a CSR.

A CA utilizará essa CSR para gerar um certificado válido e confiável.

### Criptografia e Decriptação de Arquivos

Você pode usar o OpenSSL para criptografar e descriptografar arquivos usando algoritmos simétricos, como AES.

#### Criptografar um Arquivo

Para criptografar um arquivo usando AES-256:

```bash
openssl enc -aes-256-cbc -salt -in arquivo.txt -out arquivo.txt.enc
```

**Explicação:**

- **`enc -aes-256-cbc`**: Usa o algoritmo AES-256 em modo CBC.
- **`-salt`**: Adiciona um salt para aumentar a segurança.
- **`-in arquivo.txt`**: Arquivo de entrada que será criptografado.
- **`-out arquivo.txt.enc`**: Arquivo de saída criptografado.

#### Descriptografar um Arquivo

Para descriptografar um arquivo que foi criptografado com AES-256:

```bash
openssl enc -d -aes-256-cbc -in arquivo.txt.enc -out arquivo-decriptografado.txt
```

**Explicação:**

- **`-d`**: Modo de decriptação.
- **`-aes-256-cbc`**: Algoritmo usado para decriptação.

### Geração de Hashes (MD5, SHA-256)

O OpenSSL também pode calcular hashes de arquivos, útil para verificar a integridade de dados.

####  Hash MD5

Para calcular o hash MD5 de um arquivo:

```bash
openssl dgst -md5 arquivo.txt
```

#### Hash SHA-256

Para calcular o hash SHA-256 de um arquivo:

```bash
openssl dgst -sha256 arquivo.txt
```

### Criação e Verificação de Assinaturas Digitais

Assinaturas digitais são usadas para verificar a integridade e a autenticidade de dados. Para criar uma assinatura digital, você precisa de uma chave privada e, para verificar a assinatura, uma chave pública.

#### Criar uma Assinatura Digital

Crie uma assinatura digital de um arquivo:

```bash
openssl dgst -sha256 -sign private.key -out assinatura.bin arquivo.txt
```

#### Verificar uma Assinatura Digital

Para verificar a assinatura de um arquivo:

```bash
openssl dgst -sha256 -verify public.key -signature assinatura.bin arquivo.txt
```

### Conectando a um Servidor HTTPS com OpenSSL

Uma das funcionalidades úteis do **OpenSSL** é a capacidade de se conectar diretamente a um servidor HTTPS para verificar informações sobre o certificado e o protocolo SSL/TLS utilizado. Isso é especialmente útil para profissionais de segurança e administradores de sistemas que precisam verificar a validade e a configuração de certificados SSL de sites ou servidores.

#### Comando para Conectar a um Servidor HTTPS

Para se conectar a um servidor HTTPS e visualizar o certificado do servidor, utilize o comando abaixo:

```bash
openssl s_client -connect www.exemplo.com:443
```

**Explicação:**
- **`s_client`**: Modo de cliente SSL, que permite estabelecer uma conexão SSL/TLS.
- **`-connect www.exemplo.com:443`**: Especifica o servidor e a porta HTTPS (443) para se conectar. Substitua `www.exemplo.com` pelo domínio que deseja verificar.

#### Analisando o Certificado e a Conexão

Quando você executa o comando acima, o OpenSSL estabelece uma conexão com o servidor, realiza o handshake SSL/TLS e exibe informações detalhadas sobre a conexão, incluindo:

- **Certificado SSL**: Detalhes sobre o certificado utilizado pelo servidor, como emissor, datas de validade e chave pública.
- **Handshake SSL/TLS**: Detalhes do protocolo SSL/TLS utilizado na conexão, como versão e métodos de criptografia.
- **Cadeia de Certificados**: Exibe os certificados da cadeia de confiança, desde o certificado final até a Autoridade Certificadora raiz.

#### Salvando o Certificado do Servidor

Caso queira salvar o certificado do servidor em um arquivo, você pode redirecionar a saída do comando para salvar o certificado em formato PEM:

```bash
openssl s_client -connect www.exemplo.com:443 < /dev/null | sed -ne '/-BEGIN CERTIFICATE-/,/-END CERTIFICATE-/p' > certificado.pem
```

Isso criará um arquivo `certificado.pem` contendo o certificado SSL utilizado pelo servidor.

#### Verificando o Certificado com Detalhes

Depois de salvar o certificado, você pode visualizar os detalhes completos do certificado utilizando o seguinte comando:

```bash
openssl x509 -in certificado.pem -text -noout
```

Isso exibirá detalhes do certificado, incluindo o emissor, validade, chave pública e mais.

#### Testando Diferentes Protocolos TLS

Você pode especificar o protocolo TLS que deseja testar. Por exemplo, para testar apenas o protocolo **TLSv1.2**, use:

```bash
openssl s_client -connect www.exemplo.com:443 -tls1_2
```

Para testar **TLSv1.3**:

```bash
openssl s_client -connect www.exemplo.com:443 -tls1_3
```

Dessa forma, você pode verificar se o servidor suporta diferentes versões do TLS e quais são suas preferências.