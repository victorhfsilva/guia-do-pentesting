# HTTP Requests

Consumir APIs em **Golang** é uma tarefa bastante simples e eficiente, graças ao pacote padrão **`net/http`** que oferece suporte robusto para fazer requisições HTTP e lidar com suas respostas. A seguir está um guia que abrange os principais conceitos e técnicas para consumir APIs usando Go.

## Pacotes necessários

Para começar, é necessário importar os seguintes pacotes:
- **`net/http`**: Para fazer requisições HTTP.
- **`io/ioutil`**: Para ler a resposta do corpo (body).
- **`encoding/json`**: Para lidar com JSON, que é o formato de dados mais comum em APIs.

```go
import (
    "encoding/json"
    "fmt"
    "io/ioutil"
    "net/http"
)
```

## Fazendo uma Requisição GET

### Exemplo básico de uma requisição `GET`:

```go
package main

import (
    "fmt"
    "io/ioutil"
    "net/http"
)

func main() {
    // URL da API
    url := "https://jsonplaceholder.typicode.com/posts/1"
    
    // Fazendo a requisição GET
    resp, err := http.Get(url)
    if err != nil {
        fmt.Println("Erro ao fazer a requisição:", err)
        return
    }
    defer resp.Body.Close()

    // Lendo o corpo da resposta
    body, err := ioutil.ReadAll(resp.Body)
    if err != nil {
        fmt.Println("Erro ao ler o corpo da resposta:", err)
        return
    }

    // Exibindo o corpo da resposta
    fmt.Println(string(body))
}
```

### Explicação:
- **`http.Get(url)`**: Faz a requisição HTTP do tipo GET à URL informada.
- **`resp.Body.Close()`**: É importante fechar o corpo da resposta para evitar vazamentos de memória.
- **`ioutil.ReadAll(resp.Body)`**: Lê o corpo da resposta e o converte em uma string.

## Requisições POST com Dados JSON

Para enviar dados para a API, podemos usar o método **`POST`** e incluir o **JSON** no corpo da requisição.

### Exemplo de uma requisição `POST`:

```go
package main

import (
    "bytes"
    "encoding/json"
    "fmt"
    "net/http"
)

func main() {
    // URL da API
    url := "https://jsonplaceholder.typicode.com/posts"

    // Dados que serão enviados no corpo da requisição
    data := map[string]interface{}{
        "title":  "foo",
        "body":   "bar",
        "userId": 1,
    }

    // Convertendo o mapa para JSON
    jsonData, err := json.Marshal(data)
    if err != nil {
        fmt.Println("Erro ao converter dados para JSON:", err)
        return
    }

    // Fazendo a requisição POST
    resp, err := http.Post(url, "application/json", bytes.NewBuffer(jsonData))
    if err != nil {
        fmt.Println("Erro ao fazer a requisição:", err)
        return
    }
    defer resp.Body.Close()

    // Lendo a resposta
    body, err := ioutil.ReadAll(resp.Body)
    if err != nil {
        fmt.Println("Erro ao ler o corpo da resposta:", err)
        return
    }

    fmt.Println("Resposta:", string(body))
}
```

### Explicação:
- **`json.Marshal()`**: Converte o mapa de dados para uma string JSON.
- **`http.Post(url, contentType, body)`**: Envia uma requisição POST com um corpo JSON.

## Requisições Personalizadas com `http.Client`

Para maior controle sobre a requisição (como adicionar cabeçalhos, métodos personalizados ou configurar timeouts), você pode usar a estrutura **`http.Client`**.

### Exemplo de requisição personalizada:

```go
package main

import (
    "bytes"
    "fmt"
    "net/http"
    "time"
)

func main() {
    url := "https://jsonplaceholder.typicode.com/posts/1"

    // Criando um cliente HTTP personalizado
    client := &http.Client{
        Timeout: time.Second * 10,
    }

    // Criando uma requisição personalizada (PATCH neste caso)
    req, err := http.NewRequest("PATCH", url, bytes.NewBuffer([]byte(`{"title":"updated title"}`)))
    if err != nil {
        fmt.Println("Erro ao criar a requisição:", err)
        return
    }

    // Adicionando cabeçalhos
    req.Header.Set("Content-Type", "application/json")

    // Fazendo a requisição
    resp, err := client.Do(req)
    if err != nil {
        fmt.Println("Erro ao fazer a requisição:", err)
        return
    }
    defer resp.Body.Close()

    // Exibindo o status da resposta
    fmt.Println("Status:", resp.Status)
}
```

### Explicação:
- **`http.NewRequest(method, url, body)`**: Cria uma nova requisição HTTP com o método especificado.
- **`client.Do(req)`**: Executa a requisição personalizada.

## Tratando Respostas JSON

APIs frequentemente retornam dados no formato JSON. Para trabalhar com esses dados em Go, podemos deserializar o JSON em uma estrutura Go usando **`json.Unmarshal()`**.

### Exemplo de desserialização de JSON:

```go
package main

import (
    "encoding/json"
    "fmt"
    "io/ioutil"
    "net/http"
)

// Definindo uma estrutura Go para mapear a resposta JSON
type Post struct {
    UserID int    `json:"userId"`
    ID     int    `json:"id"`
    Title  string `json:"title"`
    Body   string `json:"body"`
}

func main() {
    url := "https://jsonplaceholder.typicode.com/posts/1"

    resp, err := http.Get(url)
    if err != nil {
        fmt.Println("Erro ao fazer a requisição:", err)
        return
    }
    defer resp.Body.Close()

    body, err := ioutil.ReadAll(resp.Body)
    if err != nil {
        fmt.Println("Erro ao ler o corpo da resposta:", err)
        return
    }

    // Inicializando a estrutura Post
    var post Post

    // Desserializando o JSON no struct
    err = json.Unmarshal(body, &post)
    if err != nil {
        fmt.Println("Erro ao desserializar o JSON:", err)
        return
    }

    // Exibindo os dados desserializados
    fmt.Printf("Post ID: %d\nTitle: %s\nBody: %s\n", post.ID, post.Title, post.Body)
}
```

### Explicação:
- **`json.Unmarshal()`**: Converte os dados JSON em uma estrutura Go, de acordo com os campos e tags de JSON mapeados.

## Adicionando Query Parameters

Para adicionar parâmetros de consulta (query parameters) à URL, você pode usar a função **`net/url`**.

### Exemplo de requisição GET com query parameters:

```go
package main

import (
    "fmt"
    "net/http"
    "net/url"
)

func main() {
    baseURL := "https://jsonplaceholder.typicode.com/posts"

    // Criando os parâmetros da query
    params := url.Values{}
    params.Add("userId", "1")

    // Concatenando a query com a URL base
    fullURL := fmt.Sprintf("%s?%s", baseURL, params.Encode())

    // Fazendo a requisição GET com query parameters
    resp, err := http.Get(fullURL)
    if err != nil {
        fmt.Println("Erro ao fazer a requisição:", err)
        return
    }
    defer resp.Body.Close()

    fmt.Println("Resposta com query parameters:", resp.Status)
}
```

## Tratamento de Erros e Respostas

É importante verificar o código de status da resposta HTTP para garantir que a requisição foi bem-sucedida.

### Exemplo de tratamento de código de status:

```go
resp, err := http.Get(url)
if err != nil {
    fmt.Println("Erro:", err)
    return
}
defer resp.Body.Close()

if resp.StatusCode != http.StatusOK {
    fmt.Printf("Erro: status %d\n", resp.StatusCode)
    return
}
```