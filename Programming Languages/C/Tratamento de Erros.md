# Tratamento de Erros em C

O tratamento de erros em C é uma parte fundamental para garantir que o programa lide adequadamente com situações inesperadas ou condições de erro, como falhas ao abrir arquivos, erros de alocação de memória ou operações inválidas. 

## Códigos de Retorno de Funções

Em C, muitas funções retornam valores que indicam se a operação foi bem-sucedida ou se houve um erro. O valor de retorno pode ser usado para verificar o estado da operação e tomar ações apropriadas.

### `return` para Indicar Sucesso ou Falha

O método mais comum de indicar erros em C é o uso de códigos de retorno. Funções que executam uma operação geralmente retornam:

- Um valor **positivo ou zero** para indicar sucesso.
- Um valor **negativo ou diferente de zero** para indicar falha ou erro.

**Exemplo**:

```c
#include <stdio.h>

int dividir(int a, int b) {
    if (b == 0) {
        return -1;  // Indica erro (divisão por zero)
    }
    return a / b;  // Retorna o resultado da divisão
}

int main() {
    int resultado = dividir(10, 0);
    
    if (resultado == -1) {
        printf("Erro: Divisão por zero!\n");
    } else {
        printf("Resultado: %d\n", resultado);
    }
    
    return 0;
}
```

Neste exemplo, a função `dividir` retorna `-1` em caso de erro (divisão por zero) e o programa verifica isso com um `if` no `main`.

---

## Verificação de Erros com `errno`, `perror` e `strerror`

Além dos códigos de retorno, a linguagem C oferece mecanismos para capturar e reportar erros relacionados ao sistema, como falhas de entrada/saída ou de memória, através da variável global **`errno`** e das funções **`perror`** e **`strerror`**.

### `errno`

O **`errno`** é uma variável global definida na biblioteca `<errno.h>` que armazena o código de erro gerado pela última função do sistema que falhou. Muitas funções da biblioteca padrão de C, ao encontrar um erro, definem um valor em `errno`.

**Exemplo de Uso**:

```c
#include <stdio.h>
#include <errno.h>

int main() {
    FILE *arquivo = fopen("arquivo_inexistente.txt", "r");

    if (arquivo == NULL) {
        printf("Erro ao abrir arquivo. Código de erro: %d\n", errno);
    }

    return 0;
}
```

No exemplo acima, se a função `fopen` falhar, `errno` será configurado com um código que indica a razão do erro (como "arquivo não encontrado"). 

### `perror`

A função **`perror`** imprime uma mensagem de erro correspondente ao valor armazenado em `errno`. Ela é útil para exibir uma mensagem de erro amigável ao usuário.

**Sintaxe**:

```c
void perror(const char *mensagem);
```

- **mensagem**: Uma string que será exibida antes da mensagem de erro padrão.

**Exemplo de Uso**:

```c
#include <stdio.h>
#include <errno.h>

int main() {
    FILE *arquivo = fopen("arquivo_inexistente.txt", "r");

    if (arquivo == NULL) {
        perror("Erro ao abrir arquivo");
    }

    return 0;
}
```

No exemplo, a função `perror` exibe a mensagem passada pelo programador (`"Erro ao abrir arquivo"`) seguida pela descrição do erro padrão, como "No such file or directory".

### `strerror`

A função **`strerror`** retorna uma string correspondente ao código de erro passado como argumento. Ela pode ser usada para personalizar a forma como a mensagem de erro é exibida.

**Sintaxe**:

```c
char *strerror(int errnum);
```

- **errnum**: O código de erro (normalmente o valor de `errno`).

**Exemplo de Uso**:

```c
#include <stdio.h>
#include <errno.h>
#include <string.h>

int main() {
    FILE *arquivo = fopen("arquivo_inexistente.txt", "r");

    if (arquivo == NULL) {
        printf("Erro: %s\n", strerror(errno));
    }

    return 0;
}
```

Aqui, `strerror(errno)` retorna a descrição textual do erro correspondente ao código armazenado em `errno`.

---

## Tratamento de Erros em Funções do Sistema

Algumas funções do sistema (como operações de arquivo, alocação de memória, etc.) também dependem da verificação de erros via `errno`. É importante sempre verificar o valor de retorno dessas funções e, se necessário, verificar `errno` para identificar o tipo de erro.

### Função de Exemplo: `fopen` e `fread`

Aqui está um exemplo mais completo que usa `fopen`, `fread` e `errno` para abrir um arquivo, ler seu conteúdo e tratar possíveis erros.

```c
#include <stdio.h>
#include <errno.h>
#include <string.h>

int main() {
    FILE *arquivo = fopen("dados.txt", "r");
    if (arquivo == NULL) {
        perror("Erro ao abrir arquivo");
        return 1;  // Retorna um código de erro
    }

    char buffer[100];
    size_t n_lido = fread(buffer, sizeof(char), sizeof(buffer), arquivo);
    if (n_lido == 0 && ferror(arquivo)) {
        perror("Erro ao ler o arquivo");
        fclose(arquivo);
        return 2;
    }

    // Exibir conteúdo lido
    printf("Conteúdo lido: %s\n", buffer);

    fclose(arquivo);
    return 0;
}
```

**Explicação**:
- **`fopen`**: Abre o arquivo e verifica se houve erro (retorno `NULL`).
- **`fread`**: Lê o arquivo e verifica se ocorreu algum erro de leitura usando `ferror`.
- **`perror`**: Exibe mensagens de erro amigáveis se houver falha ao abrir ou ler o arquivo.

---

## Códigos de Erro Comuns

Aqui estão alguns dos códigos de erro mais comuns encontrados em `errno`:

- **`ENOENT`**: Arquivo ou diretório não encontrado.
- **`ENOMEM`**: Memória insuficiente.
- **`EACCES`**: Permissão negada.
- **`EBADF`**: Descritor de arquivo inválido.
- **`EIO`**: Erro de entrada/saída.

### Exemplo com Verificação de Código de Erro

```c
#include <stdio.h>
#include <errno.h>

int main() {
    FILE *arquivo = fopen("arquivo_inexistente.txt", "r");

    if (arquivo == NULL) {
        if (errno == ENOENT) {
            printf("Erro: Arquivo não encontrado.\n");
        } else if (errno == EACCES) {
            printf("Erro: Permissão negada.\n");
        } else {
            printf("Erro desconhecido: %s\n", strerror(errno));
        }
    }

    return 0;
}
```

Neste exemplo, verificamos especificamente o código de erro `ENOENT` para "arquivo não encontrado" e `EACCES` para "permissão negada", mas outros erros são tratados genericamente.
