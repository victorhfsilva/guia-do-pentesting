# Pré-processador e Macros em C

O **pré-processador** em C é uma etapa que ocorre antes da compilação do código-fonte. Ele é responsável por modificar o código antes de ser enviado ao compilador. As instruções do pré-processador são indicadas por diretivas, que começam com o caractere `#`. Elas são usadas para incluir bibliotecas, definir constantes, macros e manipular condicionalmente blocos de código.

## Diretivas de Pré-processamento

### `#include`

A diretiva `#include` é usada para incluir arquivos de cabeçalho no seu programa. Arquivos de cabeçalho normalmente contêm declarações de funções, definições de macros e constantes, e outras informações necessárias para o compilador.

Existem dois tipos principais de `#include`:

- **Incluir arquivos do sistema**: Arquivos de cabeçalho que fazem parte da biblioteca padrão ou de bibliotecas externas. Usamos `<>` para incluir arquivos do sistema.
  
  **Exemplo**:
  ```c
  #include <stdio.h>  // Inclui o cabeçalho da biblioteca de entrada e saída padrão
  ```

- **Incluir arquivos do projeto**: Arquivos de cabeçalho definidos pelo usuário (ou específicos do projeto). Usamos `""` para incluir arquivos locais.
  
  **Exemplo**:
  ```c
  #include "meu_arquivo.h"  // Inclui um arquivo de cabeçalho específico do projeto
  ```

### `#define`

A diretiva `#define` é usada para definir **constantes** ou **macros**. Ela substitui todas as ocorrências do nome definido pelo valor ou código associado, durante a fase de pré-processamento.

**Exemplo 1 - Constantes**:
```c
#define PI 3.14159  // Define uma constante chamada PI
```

**Exemplo 2 - Macros Simples**:
```c
#define QUADRADO(x) (x * x)  // Define uma macro que calcula o quadrado de um número
```

O uso de parênteses nas macros é importante para evitar erros de precedência.

**Exemplo de uso da macro**:
```c
#include <stdio.h>
#define QUADRADO(x) ((x) * (x))

int main() {
    int num = 5;
    printf("O quadrado de %d é %d\n", num, QUADRADO(num));  // Saída: O quadrado de 5 é 25
    return 0;
}
```

### `#ifdef`, `#ifndef`, `#endif`

Essas diretivas são usadas para **compilação condicional**. Elas permitem que você inclua ou exclua partes do código com base em se uma macro foi ou não definida.

- **`#ifdef`**: Compila o bloco de código se a macro estiver definida.
- **`#ifndef`**: Compila o bloco de código se a macro **não** estiver definida.
- **`#endif`**: Finaliza o bloco condicional.

**Exemplo**:
```c
#include <stdio.h>

#define DEBUG  // Se definida, ativa a seção de código condicional

int main() {
#ifdef DEBUG
    printf("Modo de depuração ativado\n");
#endif
    printf("Código principal executado\n");
    return 0;
}
```

No exemplo acima, se a macro `DEBUG` estiver definida, a mensagem "Modo de depuração ativado" será exibida. Caso contrário, o compilador ignorará essa parte do código.

---

## Macros

Uma **macro** em C é uma forma de definir um pedaço de código que pode ser reutilizado. As macros são substituídas literalmente no código durante o pré-processamento, antes de a compilação ocorrer.

### Macros Simples

Uma macro simples pode ser usada para substituir um valor constante ou uma expressão repetida.

**Exemplo**:
```c
#define TAMANHO_MAXIMO 100  // Define uma constante de valor 100

int array[TAMANHO_MAXIMO];  // Agora podemos usar TAMANHO_MAXIMO como valor constante
```

### Macros com Parâmetros

Macros também podem aceitar parâmetros, que funcionam de maneira similar às funções. O código da macro substitui a expressão com base nos argumentos passados.

**Exemplo**:
```c
#define SOMA(a, b) ((a) + (b))

int main() {
    int resultado = SOMA(5, 10);
    printf("A soma é %d\n", resultado);  // Saída: A soma é 15
    return 0;
}
```

#### Dicas para Macros com Parâmetros:

- **Parênteses**: Sempre use parênteses ao redor dos parâmetros e ao redor da expressão completa para evitar erros de precedência ao expandir a macro.
  
  **Exemplo de erro de precedência**:
  ```c
  #define QUADRADO(x) x * x
  printf("%d\n", QUADRADO(1 + 2));  // Expande para 1 + 2 * 1 + 2 = 1 + 2 + 2 = 5, que é incorreto
  ```

  Para corrigir o problema, usamos parênteses:
  ```c
  #define QUADRADO(x) ((x) * (x))  // Correto
  printf("%d\n", QUADRADO(1 + 2));  // Expande corretamente para (1 + 2) * (1 + 2) = 9
  ```

###  Macros Condicionais

Podemos usar macros para criar verificações condicionais no pré-processamento, usando `#if`, `#else`, e `#elif` para definir blocos de código com base em valores constantes.

**Exemplo**:
```c
#define VERSAO 2

#if VERSAO == 1
    printf("Versão 1\n");
#elif VERSAO == 2
    printf("Versão 2\n");
#else
    printf("Outra versão\n");
#endif
```

### Limitações de Macros

Embora sejam úteis, macros têm algumas limitações:

- **Não verificam tipos**: Ao contrário das funções, macros não verificam os tipos de argumentos.
- **Complexidade**: Macros complexas podem tornar o código difícil de entender e manter.
- **Depuração**: Erros causados por macros podem ser difíceis de identificar, já que elas são expandidas antes da compilação.

---

## Pré-processamento Condicional

As diretivas de pré-processamento condicional permitem incluir ou excluir trechos de código com base em condições. Isso é útil em projetos grandes que precisam ser compilados em diferentes ambientes ou para ativar/desativar recursos durante o desenvolvimento.

### 3.1 `#if`, `#elif`, `#else`, `#endif`

- **`#if`**: Avalia uma condição. Se for verdadeira, o bloco de código associado será incluído.
- **`#elif`**: Fornece uma alternativa ao `#if` se a condição original for falsa.
- **`#else`**: Define um bloco de código a ser incluído se todas as condições anteriores forem falsas.
- **`#endif`**: Finaliza o bloco condicional.

**Exemplo**:
```c
#define PLATAFORMA_WINDOWS

#if defined(PLATAFORMA_WINDOWS)
    printf("Código para Windows\n");
#elif defined(PLATAFORMA_LINUX)
    printf("Código para Linux\n");
#else
    printf("Outra plataforma\n");
#endif
```

Aqui, o código será incluído ou excluído com base na plataforma definida.

---

## Guardas de Inclusão

Um problema comum ao usar `#include` em projetos grandes é incluir o mesmo arquivo de cabeçalho várias vezes, o que pode causar erros de redefinição. Para evitar isso, usamos **guardas de inclusão**.

### Usando `#ifndef` para Guardas de Inclusão

A guarda de inclusão é implementada com `#ifndef`, `#define`, e `#endif` para garantir que um arquivo de cabeçalho seja incluído apenas uma vez.

**Exemplo**:

```c
#ifndef MEU_ARQUIVO_H
#define MEU_ARQUIVO_H

// Conteúdo do arquivo de cabeçalho

#endif  // Fim da guarda de inclusão
```

No exemplo acima, o código entre `#ifndef` e `#endif` será incluído apenas se a macro `MEU_ARQUIVO_H` não estiver definida. Se o arquivo for incluído novamente, a macro já estará definida e o conteúdo será ignorado.
