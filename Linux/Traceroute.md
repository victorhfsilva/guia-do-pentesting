# **Traceroute**

## Introdução

**Traceroute** é uma ferramenta de rede utilizada para diagnosticar o caminho que os pacotes percorrem entre o seu computador e um destino na rede, como um servidor ou um roteador. Ele é amplamente utilizado para identificar problemas de conectividade, determinar a rota que os pacotes seguem através da internet, e medir atrasos (latência) em cada salto do caminho.

O Traceroute é uma ferramenta essencial para administradores de rede, engenheiros de TI, e profissionais de segurança, pois ajuda a entender a topologia da rede, identificar gargalos e pontos de falha, e verificar a latência entre hops (saltos) na rota dos pacotes.

## Como o Traceroute Funciona?

O Traceroute opera enviando uma série de pacotes ICMP (Internet Control Message Protocol), UDP (User Datagram Protocol), ou TCP (Transmission Control Protocol) com diferentes valores de **TTL (Time to Live)**. Cada roteador que encontra o pacote reduz o TTL em 1. Quando o TTL chega a zero, o roteador devolve uma mensagem ICMP "Time Exceeded" ao remetente, revelando sua presença na rota.

Ao ajustar o TTL de forma incremental (começando em 1 e aumentando gradualmente), o Traceroute mapeia cada salto no caminho entre o host de origem e o destino final.

## Instalação do Traceroute

A maioria dos sistemas operacionais já possui o Traceroute instalado por padrão. No entanto, se não estiver disponível, veja como instalá-lo:

### Linux (Debian/Ubuntu)

```bash
sudo apt-get update
sudo apt-get install traceroute
```

## Uso Básico do Traceroute

A sintaxe básica do Traceroute em sistemas Unix-like é:

```bash
traceroute <destino>
```

Exemplo:

```bash
traceroute example.com
```

Este comando enviará pacotes para `example.com` e mostrará cada salto na rota até o destino.

### Exemplo de Saída:

```plaintext
traceroute to example.com (93.184.216.34), 30 hops max, 60 byte packets
 1  192.168.1.1 (192.168.1.1)  1.335 ms  1.106 ms  1.085 ms
 2  10.10.10.1 (10.10.10.1)  4.245 ms  4.167 ms  4.151 ms
 3  203.0.113.1 (203.0.113.1)  15.623 ms  15.601 ms  15.573 ms
 4  * * *
 5  93.184.216.34 (93.184.216.34)  20.257 ms  20.193 ms  20.160 ms
```

- **1**: Mostra o primeiro salto (normalmente o roteador local).
- **4**: Salto onde os pacotes não obtiveram resposta (`*` indica pacotes perdidos ou bloqueados).
- **5**: Salto final, chegando ao destino.

## Principais Opções do Traceroute

O Traceroute possui várias opções que permitem ajustar a análise para se adaptar a diferentes cenários e necessidades:

### Definir o Número Máximo de Saltos (`-m`)

Por padrão, o Traceroute permite até 30 saltos. Para ajustar esse limite, use a opção `-m`:

```bash
traceroute -m 20 example.com
```

Esse comando limita o número de saltos a 20.

### Definir o Intervalo entre Pacotes (`-w`)

Para ajustar o tempo de espera por uma resposta antes de tentar o próximo salto, use a opção `-w`:

```bash
traceroute -w 2 example.com
```

Aqui, o Traceroute aguardará 2 segundos por uma resposta antes de seguir para o próximo salto.

### Definir o Tipo de Pacote Usado (`-I`, `-T`, `-U`)

O Traceroute pode usar diferentes tipos de pacotes: **ICMP**, **TCP**, ou **UDP**. Por padrão, o Traceroute usa pacotes UDP em sistemas Unix-like, mas você pode alterar para ICMP ou TCP:

- **ICMP** (`-I`): Similar ao comportamento do **tracert** no Windows.

  ```bash
  traceroute -I example.com
  ```

- **TCP** (`-T`): Útil para passar por firewalls que bloqueiam ICMP.

  ```bash
  traceroute -T example.com
  ```

### Especificar a Porta de Destino (`-p`)

A porta de destino padrão para o Traceroute com UDP é 33434. Você pode alterá-la com a opção `-p`:

```bash
traceroute -p 443 example.com
```

Isso é útil quando você quer testar a rota específica para uma porta usada por um serviço, como HTTPS (porta 443).

### Alterar o Tamanho dos Pacotes (`-q`)

A opção `-q` define o número de pacotes a serem enviados por salto. O padrão é 3 pacotes por salto:

```bash
traceroute -q 1 example.com
```

Neste exemplo, apenas um pacote é enviado para cada salto, reduzindo o tráfego.

### Especificar o TTL Inicial (`-f`)

Você pode iniciar o Traceroute com um TTL maior que 1 para começar mais adiante na rota:

```bash
traceroute -f 5 example.com
```

Isso faz com que o Traceroute comece o mapeamento a partir do quinto salto.

## Usando o Traceroute para Diagnóstico de Rede

### Identificar Pontos de Latência

O Traceroute é frequentemente usado para identificar onde está ocorrendo alta latência na rede. Ao observar a saída, você pode ver exatamente onde o tempo de resposta aumenta, indicando um possível problema.

```plaintext
traceroute to example.com (93.184.216.34), 30 hops max, 60 byte packets
 1  192.168.1.1 (192.168.1.1)  1.110 ms  1.056 ms  1.023 ms
 2  10.10.10.1 (10.10.10.1)  4.243 ms  4.164 ms  4.138 ms
 3  203.0.113.1 (203.0.113.1)  100.652 ms  100.620 ms  100.587 ms
```

Aqui, o terceiro salto tem uma latência significativamente maior, sugerindo que o problema de desempenho está nesse ponto.

### Detectar Firewalls ou Filtros de Pacotes

Quando um Traceroute exibe `* * *`, isso pode indicar que um firewall ou dispositivo de segurança está bloqueando os pacotes ICMP ou UDP. Esse bloqueio não significa necessariamente um problema, mas é um indicativo de que o tráfego está sendo filtrado.

### Mapear a Topologia da Rede

O Traceroute também é usado para mapear a topologia da rede entre o ponto de origem e o destino, ajudando a visualizar o caminho físico e lógico que os dados percorrem. Isso é útil para identificar roteadores, sistemas autônomos (AS), e redes intermediárias que impactam a conectividade.

### Testar Conectividade com Diferentes Protocolos

Alterando o tipo de pacote (ICMP, TCP, UDP), o Traceroute pode testar a rota de conectividade para serviços específicos. Por exemplo, o uso do TCP na porta 443 pode simular o caminho real de uma conexão HTTPS.

```bash
traceroute -T -p 443 example.com
```

## Boas Práticas e Limitações do Traceroute

### Boas Práticas

1. **Use Diferentes Tipos de Pacotes**: Alterne entre ICMP, TCP e UDP para identificar filtros de pacotes e firewalls que podem estar bloqueando tipos específicos de tráfego.
   
2. **Analise Saltos Consistentes**: Se o mesmo salto apresentar alta latência de forma consistente, isso pode indicar um gargalo de rede.

3. **Documente as Rotas**: Em redes corporativas, documentar as rotas dos pacotes pode ajudar a identificar mudanças na topologia da rede ao longo do tempo.

### Limitações

- **Firewalls e Filtros**: Firewalls podem bloquear pacotes do Traceroute, resultando em respostas como `* * *`, mesmo quando a conectividade está boa.
- **Roteadores Silenciosos**: Alguns roteadores estão configurados para não responder a pacotes ICMP, UDP, ou TCP de diagnóstico.
- **Variações de Latência**: A latência pode variar por múltiplos motivos, como tráfego de rede momentâneo, políticas de QoS, ou balanceamento de carga, dificultando uma análise precisa.
