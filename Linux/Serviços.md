## Serviços no Linux

### Introdução

No Linux, um serviço é um programa ou daemon que roda em segundo plano, executando tarefas essenciais sem intervenção direta do usuário. Esses serviços são gerenciados pelo sistema de init ou pelo `systemd`, que é o mais comum nas distribuições modernas. 

### Conceitos Básicos

####  Daemon
Um daemon é um tipo de programa que roda em segundo plano, geralmente iniciado durante a inicialização do sistema. Exemplos incluem `httpd` (Apache), `sshd` (servidor SSH), e `cron` (agendador de tarefas).

#### Systemd
`Systemd` é o sistema de inicialização e gerenciamento de serviços mais comum em distribuições modernas do Linux. Ele substituiu sistemas init mais antigos como o `SysVinit` e o `Upstart`.

- **Unidade (Unit)**: No `systemd`, serviços são configurados em unidades, que podem ser de diferentes tipos como `service`, `socket`, `device`, etc. O foco principal aqui será nas unidades de serviço (`.service`).

### Gerenciamento de Serviços com `systemd`

#### Comandos Básicos

- **Verificar o status de um serviço**

```bash
systemctl status nome_do_serviço
```
  
  Este comando exibe se o serviço está ativo (em execução), inativo, ou falhou, juntamente com os últimos logs.

- **Iniciar um serviço**

```bash
systemctl start nome_do_serviço
```
  
  Isso inicia o serviço especificado.

- **Parar um serviço**

  ```bash
  systemctl stop nome_do_serviço
  ```
  
  Isso para o serviço especificado.

- **Reiniciar um serviço**

```bash
systemctl restart nome_do_serviço
```

  Isso para e, em seguida, reinicia o serviço especificado.

- **Recarregar a configuração de um serviço**
	
```bash
systemctl reload nome_do_serviço
```
 
  Recarrega a configuração do serviço sem interrompê-lo.

- **Habilitar um serviço na inicialização**

```bash
systemctl enable nome_do_serviço
```

Ou,

```bash
update-rc.d ssh enable
```

  Isso faz com que o serviço seja iniciado automaticamente durante a inicialização do sistema.

- **Desabilitar um serviço na inicialização**

```bash
systemctl disable nome_do_serviço
```

Ou,

```bash
update-rc.d ssh disable
```

  Impede que o serviço seja iniciado automaticamente na inicialização.

- **Verificar se um serviço está habilitado**

```bash
systemctl is-enabled nome_do_serviço
```

#### Tipos de Unidades no `systemd`

- **.service**: Unidades que representam serviços.
- **.socket**: Unidades que encapsulam um socket na rede.
- **.device**: Unidades que representam dispositivos de hardware.
- **.mount**: Unidades que representam sistemas de arquivos montados.

### Arquivos de Serviço

#### Localização dos Arquivos de Serviço
Os arquivos de configuração dos serviços são localizados em `/etc/systemd/system/` e `/usr/lib/systemd/system/`.

####  Estrutura de um Arquivo `.service`
Um arquivo de unidade de serviço geralmente possui a seguinte estrutura:

```ini
[Unit]
Description=Descrição do Serviço
After=network.target

[Service]
ExecStart=/usr/bin/executável
ExecReload=/bin/kill -HUP $MAINPID
Restart=on-failure

[Install]
WantedBy=multi-user.target
```

- **[Unit]**: Define metadados e dependências do serviço.
- **[Service]**: Define como o serviço deve ser iniciado, reiniciado e parado.
- **[Install]**: Define quando o serviço deve ser iniciado, como durante o boot.

### Gerenciamento de Serviços Legados com `SysVinit`

Embora `systemd` seja amplamente usado, algumas distribuições ainda utilizam o `SysVinit` ou precisam gerenciar scripts de inicialização mais antigos.

#### Comandos Básicos com `service`

- **Iniciar um serviço**

```bash
service nome_do_serviço start
```

- **Parar um serviço**

```bash
service nome_do_serviço stop
```

- **Reiniciar um serviço**

```bash
service nome_do_serviço restart
```
  
- **Verificar o status de um serviço**

```bash
service nome_do_serviço status
```

#### Scripts de Inicialização

Os scripts para serviços gerenciados pelo `SysVinit` estão localizados em `/etc/init.d/`. Eles podem ser usados para iniciar, parar ou reiniciar serviços.

### Monitoramento e Logs de Serviços

- **Logs de Serviços**: Use o comando `journalctl` para visualizar logs de serviços gerenciados pelo `systemd`.

```bash
journalctl -u nome_do_serviço
```

- **Monitoramento**: Ferramentas como `monit` e `Nagios` podem ser usadas para monitorar o estado dos serviços e notificar administradores em caso de falhas.

### Práticas Recomendadas

- **Automatização**: Use `systemctl enable` para automatizar o início de serviços essenciais na inicialização.
- **Segurança**: Restrinja o acesso aos arquivos de configuração de serviços e monitore regularmente os logs de serviços críticos.
- **Documentação**: Mantenha documentação clara sobre a configuração de serviços no seu ambiente, especialmente se houver personalizações.