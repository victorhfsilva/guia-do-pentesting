# Logs no Linux

### Introdução

Logs no Linux são registros que capturam eventos e atividades do sistema, ajudando administradores e usuários a monitorar, depurar e manter a saúde do sistema. Eles são cruciais para entender o comportamento do sistema, diagnosticar problemas e auditar atividades.

### Estrutura de Logs no Linux

#### Diretório `/var/log`
A maioria dos logs do sistema Linux é armazenada no diretório `/var/log`. Aqui estão alguns dos arquivos de log mais comuns:

- **/var/log/syslog**: Contém mensagens do sistema e de outros processos. É o principal log usado para monitorar o sistema.
- **/var/log/auth.log**: Registra todas as tentativas de autenticação, incluindo logins bem-sucedidos e falhas.
- **/var/log/kern.log**: Contém mensagens do kernel. É útil para diagnosticar problemas relacionados ao hardware e ao núcleo do sistema.
- **/var/log/dmesg**: Mostra as mensagens geradas durante a inicialização do sistema, relacionadas principalmente ao hardware.
- **/var/log/boot.log**: Armazena mensagens relacionadas ao processo de inicialização do sistema.
- **/var/log/cron.log**: Contém registros das tarefas agendadas pelo cron.
- **/var/log/mail.log**: Armazena logs relacionados ao servidor de e-mail.
- **/var/log/faillog**: Contém informações sobre tentativas de login falhas.
- **/var/log/lastlog**: Armazena informações sobre o último login de cada usuário.

#### Arquivos de Log por Serviços

Muitos serviços criam seus próprios logs no diretório `/var/log/`. Por exemplo:

- **Apache**: `/var/log/apache2/`
- **MySQL**: `/var/log/mysql/`
- **Nginx**: `/var/log/nginx/`

### Ferramentas para Visualização e Análise de Logs

#### Comandos Básicos

- **cat**: Exibe o conteúdo de um arquivo de log.
  ```bash
  cat /var/log/syslog
  ```

- **tail**: Exibe as últimas linhas de um arquivo de log. Adicione o parâmetro `-f` para seguir o log em tempo real.
  ```bash
  tail -f /var/log/syslog
  ```

- **head**: Exibe as primeiras linhas de um arquivo de log.
  ```bash
  head /var/log/syslog
  ```

- **less**: Permite visualizar o arquivo de log de forma paginada.
  ```bash
  less /var/log/syslog
  ```

- **grep**: Busca por padrões específicos dentro de um log.
  ```bash
  grep "ERROR" /var/log/syslog
  ```

####  `journalctl`

O comando `journalctl` é usado para visualizar logs gerenciados pelo `systemd`, que é o sistema de inicialização mais comum em distribuições modernas do Linux.

- Exibir todos os logs:
  ```bash
  journalctl
  ```

- Exibir logs do boot atual:
  ```bash
  journalctl -b
  ```

- Filtrar por serviço específico:
  ```bash
  journalctl -u nome_do_serviço
  ```

- Seguir logs em tempo real:
  ```bash
  journalctl -f
  ```

### Gerenciamento de Logs

#### Log Rotation

A rotação de logs é o processo de renomear um arquivo de log existente e criar um novo arquivo para continuar a captura dos logs. Isso ajuda a evitar que arquivos de log cresçam indefinidamente e ocupem muito espaço em disco.

- **logrotate**: O Linux usa o `logrotate` para gerenciar a rotação dos logs. O arquivo de configuração principal fica em `/etc/logrotate.conf`, e cada serviço pode ter sua configuração específica em `/etc/logrotate.d/`.

#### Configuração de Logrotate
Um exemplo básico de configuração do `logrotate`:

```bash
/var/log/syslog {
    daily
    rotate 7
    compress
    delaycompress
    missingok
    notifempty
    create 0640 root adm
    postrotate
        /usr/lib/rsyslog/rsyslog-rotate
    endscript
}
```

- **daily**: Rota o log diariamente.
- **rotate 7**: Mantém os últimos 7 arquivos de log.
- **compress**: Comprime os logs após a rotação.
- **delaycompress**: Retarda a compressão até a próxima rotação.
- **missingok**: Ignora o erro se o arquivo de log estiver ausente.
- **notifempty**: Não roda se o log estiver vazio.
- **create**: Define as permissões e o proprietário do novo arquivo de log.

### Práticas Recomendadas

- **Monitoramento Regular**: Automatize o monitoramento de logs críticos usando ferramentas como `logwatch` ou `Swatch`.
- **Segurança dos Logs**: Garanta que os logs sensíveis estejam acessíveis apenas por usuários autorizados.
- **Auditoria**: Periodicamente, revise os logs para garantir que as práticas de segurança estão sendo seguidas.
- **Automatização**: Use scripts e ferramentas para automatizar a análise de logs, notificações de eventos críticos e rotação de logs.