# **snmpwalk**

**snmpwalk** é uma ferramenta de linha de comando amplamente utilizada para interagir com dispositivos que utilizam o **SNMP (Simple Network Management Protocol)**. O **SNMP** é um protocolo de gerenciamento de dispositivos de rede, como roteadores, switches, servidores e impressoras. A ferramenta **snmpwalk** permite que você percorra informações de gerenciamento disponíveis em dispositivos SNMP, extraindo dados detalhados sobre o estado e a configuração desses dispositivos.

O **snmpwalk** é parte do pacote **Net-SNMP** e é usado principalmente para recuperar informações de um dispositivo de rede usando uma **OID (Object Identifier)** de forma recursiva, listando todos os objetos relacionados.

## Características do snmpwalk

- **Interação com Dispositivos SNMP**: Recupera informações de dispositivos que suportam o protocolo SNMP.
- **Varredura Recursiva**: Percorre recursivamente uma árvore de OIDs, retornando todos os dados disponíveis.
- **Compatível com SNMPv1, SNMPv2c e SNMPv3**: Suporta as três versões principais do protocolo SNMP, cada uma com diferentes níveis de segurança.
- **Uso Flexível**: Pode ser usado para monitoramento de rede, auditorias de dispositivos e coleta de informações de diagnóstico.

## Instalação do snmpwalk

O **snmpwalk** faz parte do pacote **Net-SNMP**, que pode ser facilmente instalado na maioria das distribuições Linux. Abaixo estão as instruções para instalar o **snmpwalk**.

### Instalação no Linux

#### Em distribuições baseadas em Debian/Ubuntu:

```bash
sudo apt-get update
sudo apt-get install snmp
```

### Verificando a Instalação

Após a instalação, você pode verificar se o **snmpwalk** foi instalado corretamente com o seguinte comando:

```bash
snmpwalk --version
```

Isso exibirá a versão instalada do **Net-SNMP**.

## Uso Básico do snmpwalk

O **snmpwalk** é utilizado para consultar um dispositivo de rede SNMP e recuperar informações organizadas em uma estrutura hierárquica de OIDs (Object Identifiers). Ele pode ser usado para obter informações de dispositivos como roteadores, switches, servidores e muito mais.

### Estrutura Básica do Comando

A sintaxe básica do comando **snmpwalk** é:

```bash
snmpwalk -v <versão_SNMP> -c <string_de_comunidade> <endereço_IP> <OID>
```

- **`-v`**: Especifica a versão do SNMP (v1, v2c ou v3).
- **`-c`**: A string de comunidade SNMP (usada para autenticação em SNMPv1 e SNMPv2c).
- **`<endereço_IP>`**: O endereço IP do dispositivo que você deseja consultar.
- **`<OID>`**: A OID a ser consultada. Se não for especificada, o **snmpwalk** percorrerá todas as OIDs.

### Exemplo de Consulta Básica

Aqui está um exemplo simples para consultar um dispositivo com o IP **192.168.1.1** usando a string de comunidade **public** e a versão SNMPv2c:

```bash
snmpwalk -v 2c -c public 192.168.1.1
```

Esse comando retorna todas as OIDs disponíveis no dispositivo **192.168.1.1** que podem ser consultadas com a string de comunidade **public**.

### Consultando uma OID Específica

Você pode especificar uma OID para consultar apenas uma parte específica da árvore de informações do dispositivo. Por exemplo, para consultar o nome do sistema, você pode usar a OID correspondente:

```bash
snmpwalk -v 2c -c public 192.168.1.1 1.3.6.1.2.1.1.5
```

A OID **1.3.6.1.2.1.1.5** refere-se ao nome do sistema (sysName), que retornará o nome de host do dispositivo.

### Usando SNMPv3 (Autenticação e Criptografia)

O **SNMPv3** oferece maior segurança com suporte para autenticação e criptografia. A sintaxe para SNMPv3 requer especificar o nome do usuário, método de autenticação e, opcionalmente, a criptografia.

**Exemplo com SNMPv3**:

```bash
snmpwalk -v 3 -u usuario -l authPriv -a MD5 -A senha_autenticacao -x DES -X senha_privacidade 192.168.1.1
```

Neste exemplo:
- **`-u usuario`**: O nome de usuário SNMPv3.
- **`-l authPriv`**: O nível de segurança, que inclui autenticação e criptografia.
- **`-a MD5`**: O algoritmo de autenticação (pode ser **MD5** ou **SHA**).
- **`-A senha_autenticacao`**: A senha de autenticação.
- **`-x DES`**: O algoritmo de criptografia (pode ser **DES** ou **AES**).
- **`-X senha_privacidade`**: A senha de privacidade (para criptografia).

### Usando IPv6

O **snmpwalk** também suporta o uso de endereços IPv6. Para consultar um dispositivo SNMP com IPv6, use o endereço IPv6 do dispositivo:

```bash
snmpwalk -v 2c -c public fe80::1
```

Isso fará uma varredura SNMP em um dispositivo com endereço IPv6.

## Principais OIDs Utilizados

O **SNMP** organiza suas informações em uma hierarquia de OIDs. Algumas das OIDs mais comuns para dispositivos de rede são as seguintes:

### OIDs de Informações do Sistema

- **`1.3.6.1.2.1.1.1`** (sysDescr): Descrição completa do sistema.
- **`1.3.6.1.2.1.1.3`** (sysUpTime): Tempo desde que o sistema foi iniciado.
- **`1.3.6.1.2.1.1.5`** (sysName): Nome do sistema (hostname).
- **`1.3.6.1.2.1.1.7`** (sysServices): Serviços fornecidos pelo sistema.

### OIDs de Interfaces de Rede

- **`1.3.6.1.2.1.2.2.1.2`** (ifDescr): Descrição das interfaces de rede.
- **`1.3.6.1.2.1.2.2.1.8`** (ifOperStatus): Estado operacional das interfaces.
- **`1.3.6.1.2.1.2.2.1.10`** (ifInOctets): Número de bytes recebidos pela interface.
- **`1.3.6.1.2.1.2.2.1.16`** (ifOutOctets): Número de bytes enviados pela interface.

### OIDs de Gerenciamento de CPU e Memória

- **`1.3.6.1.4.1.2021.10.1.3`** (ucdavis): Carga de CPU.
- **`1.3.6.1.4.1.2021.4.5`** (memTotalReal): Memória total no dispositivo.
- **`1.3.6.1.4.1.2021.4.6`** (memAvailReal): Memória disponível no dispositivo.

### OIDs de Dados relevantes do Windows

- **`1.3.6.1.4.1.77.1.2.25`**: Usuários
- **`1.3.6.1.2.1.25.4.2.1.2`**: Processos em execução
- **`1.3.6.1.2.1.6.13.1.3`**: Portas TCP Abertas
- **`1.3.6.1.2.1.25.6.3.1.2`**: Software instalado

Essas são apenas algumas das OIDs mais comuns usadas no gerenciamento de dispositivos de rede. A árvore de OIDs é muito extensa, e você pode explorá-la com o **snmpwalk** para descobrir mais informações sobre dispositivos específicos.

## Filtrando Resultados com Grep

Os resultados retornados pelo **snmpwalk** podem ser extensos, especialmente ao consultar sem uma OID específica. Para facilitar a leitura, você pode usar o **grep** para filtrar os resultados.

**Exemplo**: Para listar apenas as interfaces de rede de um dispositivo, você pode usar:

```bash
snmpwalk -v 2c -c public 192.168.1.1 | grep ifDescr
```

Esse comando exibirá apenas as descrições das interfaces de rede do dispositivo.

## Boas Práticas ao Usar snmpwalk

1. **Use SNMPv3 Sempre que Possível**: O SNMPv1 e SNMPv2c transmitem dados e credenciais em texto claro. Sempre prefira usar **SNMPv3**, que oferece autenticação e criptografia.

2. **Restringir Acesso ao SNMP**: Garanta que apenas redes e dispositivos autorizados possam consultar dispositivos SNMP. Use firewalls e listas de controle de acesso (ACLs) para proteger seus dispositivos.

3. **Evite Comunidades Padrão**: Strings de comunidade como **public** e **private** são alvos comuns de ataques. Altere essas strings para algo mais seguro e personalizado.

4. **Monitore o Tráfego SNMP**: O tráfego SNMP pode fornecer informações críticas sobre o estado e a segurança da sua rede. Configure sistemas de monitoramento para alertá-lo sobre atividades incomuns.

5. **Minimize o Escopo de Consultas**: Especificar uma OID ao usar **snmpwalk** pode reduzir a quantidade de dados retornados e facilitar a análise.
