
# **rpcclient**

## Introdução

**rpcclient** é uma ferramenta de linha de comando do **Samba** utilizada para interagir com serviços de **RPC (Remote Procedure Call)** em servidores Windows ou Samba. O **RPC** é um protocolo utilizado para realizar chamadas de procedimentos remotos, permitindo que programas executem funções em outras máquinas em rede, facilitando a comunicação entre clientes e servidores.

O **rpcclient** permite que administradores de sistemas e profissionais de segurança realizem consultas e interajam com serviços Windows, como obter informações de usuários, listar compartilhamentos, gerenciar permissões e muito mais. Ele é frequentemente usado durante auditorias de segurança e pentests para coletar informações detalhadas sobre o ambiente de rede Windows.

## Características do rpcclient

- **Consulta de Informações do Servidor**: Permite obter detalhes sobre usuários, grupos, compartilhamentos e mais de servidores Windows.
- **Gerenciamento de Contas de Usuário**: Pode listar e modificar contas de usuário em servidores que rodam o Windows.
- **Execução de Procedimentos Remotos**: Executa comandos e procedimentos remotos em servidores utilizando chamadas RPC.
- **Autenticação Flexível**: Suporta diferentes métodos de autenticação, como NTLM e Kerberos.

## Uso Básico do rpcclient

O **rpcclient** pode ser utilizado para se conectar a um servidor Windows ou Samba e realizar várias operações administrativas. A seguir estão os comandos e usos mais comuns do **rpcclient**.

### Conectando-se a um Servidor

Para iniciar uma sessão RPC, você pode se conectar a um servidor fornecendo seu endereço IP ou nome de host e credenciais de autenticação. O comando básico para isso é:

```bash
rpcclient -U usuario%senha <servidor>
```

**Exemplo:**

```bash
rpcclient -U administrador%mypassword 192.168.1.10
```

**Explicação:**

- **`-U usuario%senha`**: Especifica o nome de usuário e senha para autenticação. Se a senha for omitida, você será solicitado a inseri-la.
- **`<servidor>`**: O endereço IP ou nome do host do servidor.

Se o servidor permitir autenticação anônima, você pode se conectar sem um nome de usuário e senha:

```bash
rpcclient -N 192.168.1.10
```

### Listando Compartilhamentos

Uma vez conectado, você pode listar os compartilhamentos disponíveis no servidor utilizando o comando `netshareenum`:

```bash
rpcclient $> netshareenum
```

Isso exibe todos os compartilhamentos de arquivos no servidor.

### Listando Usuários

Para listar os usuários do servidor, você pode usar o comando `enumdomusers`:

```bash
rpcclient $> enumdomusers
```

Isso retornará uma lista de usuários no domínio.

### Obtendo Informações de Usuários

Depois de listar os usuários, você pode obter informações detalhadas sobre um usuário específico utilizando o comando `queryuser` e fornecendo o **RID** (Relative Identifier) do usuário:

```bash
rpcclient $> queryuser <RID>
```

Para descobrir o RID de um usuário, você pode usar o comando `lookupnames`:

```bash
rpcclient $> lookupnames <nome_de_usuario>
```

**Exemplo:**

```bash
rpcclient $> lookupnames administrador
rpcclient $> queryuser 500
```

### Listando Grupos

Para listar os grupos disponíveis no servidor, utilize o comando `enumdomgroups`:

```bash
rpcclient $> enumdomgroups
```

Esse comando listará todos os grupos no servidor.

### Alterando Senha de um Usuário

Se você tiver permissões administrativas, pode alterar a senha de um usuário utilizando o comando `setuserinfo2`:

```bash
rpcclient $> setuserinfo2 <nome_de_usuario> 23 <nova_senha>
```

**Exemplo:**

```bash
rpcclient $> setuserinfo2 usuario 23 novaSenha123
```

### Listando Controladores de Domínio

Você pode listar todos os controladores de domínio (Domain Controllers) no ambiente utilizando o comando `getdompwinfo`:

```bash
rpcclient $> getdompwinfo
```

### Executando Comandos RPC

Além dos comandos mencionados, você pode executar várias outras chamadas RPC dependendo do que o servidor permitir. Use `help` no terminal do **rpcclient** para ver a lista completa de comandos disponíveis:

```bash
rpcclient $> help
```
