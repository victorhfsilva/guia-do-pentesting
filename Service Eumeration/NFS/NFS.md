# NFS

## Introdução

**NFS (Network File System)** é um protocolo de rede utilizado para compartilhar diretórios e arquivos entre sistemas em uma rede. Ele permite que você monte remotamente diretórios de um servidor NFS em seu sistema local e interaja com os arquivos como se estivessem no sistema local. O NFS é amplamente utilizado em ambientes Linux e Unix para compartilhar dados entre servidores e clientes.

Interagir com NFS envolve configurar corretamente o servidor e o cliente, montar os compartilhamentos e realizar operações de leitura e gravação nos diretórios montados. Este guia abordará como interagir com servidores NFS via terminal, incluindo a montagem e o gerenciamento de compartilhamentos NFS.

## Características do NFS

- **Compartilhamento de Arquivos entre Sistemas**: Permite que um sistema cliente acesse e interaja com arquivos em um servidor NFS como se estivessem em seu próprio sistema.
- **Montagem de Diretórios Remotos**: Os diretórios remotos são montados localmente, permitindo o acesso direto a eles.
- **Suporte Multiusuário**: Oferece suporte para múltiplos clientes acessando o mesmo compartilhamento simultaneamente.
- **Segurança**: NFSv4, a versão mais recente do protocolo, inclui suporte para autenticação e criptografia.

## Instalação do NFS

Antes de interagir com o NFS, é necessário instalar os pacotes necessários tanto no servidor quanto no cliente.

### Instalando o Servidor NFS no Linux

No servidor, você precisa instalar o pacote **nfs-kernel-server**.

#### Em distribuições baseadas em Debian/Ubuntu:

```bash
sudo apt-get update
sudo apt-get install nfs-kernel-server
```

### Instalando o Cliente NFS no Linux

No cliente, você precisará instalar o pacote **nfs-common** ou equivalente, dependendo da sua distribuição.

#### Em distribuições baseadas em Debian/Ubuntu:

```bash
sudo apt-get install nfs-common
```

## Configuração do Servidor NFS

Para configurar um servidor NFS, é necessário exportar os diretórios que você deseja compartilhar com os clientes.

### Configurando os Diretórios para Compartilhamento

A configuração do servidor NFS é feita no arquivo **/etc/exports**. Neste arquivo, você define quais diretórios serão compartilhados e para quais clientes.

Abra o arquivo **/etc/exports** para edição:

```bash
sudo nano /etc/exports
```

Adicione uma linha para definir o diretório a ser compartilhado. Por exemplo:

```plaintext
/home/compartilhado 192.168.1.0/24(rw,sync,no_subtree_check)
```

**Explicação:**

- **`/home/compartilhado`**: O diretório no servidor que será compartilhado.
- **`192.168.1.0/24`**: A sub-rede ou o endereço IP do cliente que terá acesso ao compartilhamento.
- **`rw`**: Permite leitura e gravação.
- **`sync`**: Garante que as alterações sejam gravadas no disco imediatamente.
- **`no_subtree_check`**: Desabilita verificações adicionais no diretório.

###  Aplicando as Configurações

Após editar o arquivo **/etc/exports**, aplique as configurações com o comando:

```bash
sudo exportfs -a
```

Em seguida, reinicie o serviço NFS:

#### Em distribuições Debian/Ubuntu:

```bash
sudo systemctl restart nfs-kernel-server
```

### Verificando os Compartilhamentos

Para verificar os diretórios compartilhados pelo servidor NFS, use o seguinte comando:

```bash
sudo exportfs -v
```

Esse comando listará todos os diretórios que estão sendo compartilhados, as permissões associadas e os clientes que têm acesso.

## Configuração do Cliente NFS

Uma vez que o servidor NFS esteja configurado, o próximo passo é configurar o cliente para acessar os compartilhamentos NFS.

### Montando um Compartilhamento NFS Manualmente

Para montar um compartilhamento NFS manualmente em um cliente, use o comando **mount**.

#### Passo a Passo:

1. Crie um diretório local onde o compartilhamento será montado:

```bash
sudo mkdir -p /mnt/compartilhado
```

2. Monte o compartilhamento NFS:

```bash
sudo mount -t nfs <endereço_do_servidor>:/caminho_do_diretório /mnt/compartilhado
```

**Exemplo:**

```bash
sudo mount -t nfs 192.168.1.10:/home/compartilhado /mnt/compartilhado
```

Neste exemplo, o diretório `/home/compartilhado` no servidor `192.168.1.10` será montado localmente no diretório `/mnt/compartilhado`.

3. Verifique se o compartilhamento foi montado corretamente:

```bash
df -h
```

Este comando exibirá os sistemas de arquivos montados, incluindo o NFS.

###  Montagem Automática com fstab

Se você quiser montar o compartilhamento NFS automaticamente durante a inicialização, adicione-o ao arquivo **/etc/fstab** no cliente.

1. Abra o arquivo **/etc/fstab**:

```bash
sudo nano /etc/fstab
```

2. Adicione a seguinte linha:

```plaintext
<endereço_do_servidor>:/caminho_do_diretório /mnt/compartilhado nfs defaults 0 0
```

**Exemplo:**

```plaintext
192.168.1.10:/home/compartilhado /mnt/compartilhado nfs defaults 0 0
```

3. Salve o arquivo e monte todos os sistemas de arquivos especificados no **fstab** com o comando:

```bash
sudo mount -a
```

### Desmontando o Compartilhamento NFS

Se você quiser desmontar um compartilhamento NFS, use o comando **umount**:

```bash
sudo umount /mnt/compartilhado
```


## Resolução de Problemas

### Problemas de Permissão

Se você enfrentar problemas de permissão ao tentar acessar ou modificar arquivos no compartilhamento NFS, verifique as permissões de usuário e grupo no servidor e no cliente. O NFS utiliza IDs de usuário (UID) e IDs de grupo (GID), que devem ser consistentes entre o servidor e o cliente para evitar problemas.

### Verificando Logs

Verifique os logs do sistema no servidor e no cliente para identificar possíveis problemas. Os logs no **/var/log/syslog** ou **/var/log/messages** (dependendo da distribuição) podem conter informações úteis sobre erros de NFS.

### Verificando Firewalls

Certifique-se de que as portas NFS (tipicamente 2049 para NFS e outras portas para serviços relacionados) estão abertas no firewall do servidor.

### Testando Conectividade

Se houver problemas de conectividade, use o comando **showmount** para verificar se o cliente pode ver os compartilhamentos no servidor:

```bash
showmount -e <endereço_do_servidor>
```
