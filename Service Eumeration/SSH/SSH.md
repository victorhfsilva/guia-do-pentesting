# Guia Completo sobre SSH

## Introdução

**SSH (Secure Shell)** é um protocolo de rede amplamente utilizado para acessar de forma segura servidores e dispositivos remotos. Ele oferece uma maneira segura de gerenciar sistemas, transferir arquivos, executar comandos remotos e muito mais, utilizando criptografia para proteger as comunicações. O SSH substituiu o **Telnet** e outros protocolos não seguros, pois fornece autenticação forte e criptografia de tráfego.

## Características do SSH

- **Acesso Remoto Seguro**: Oferece uma maneira segura de acessar servidores e executar comandos remotamente.
- **Criptografia**: Todas as comunicações entre o cliente e o servidor são criptografadas.
- **Autenticação por Senha e Chave Pública**: Suporta autenticação por senha ou por pares de chaves públicas e privadas.
- **Túnel SSH**: Permite a criação de túneis criptografados para redirecionar tráfego de outros protocolos através do SSH.
- **Transferência Segura de Arquivos**: Com o **SCP** ou **SFTP**, você pode transferir arquivos de forma segura entre máquinas.

## Instalação do SSH

###  Instalação do Servidor SSH

No Linux, o servidor SSH é fornecido pelo pacote **OpenSSH**. A seguir estão as instruções para instalar o servidor SSH (chamado **sshd**) e o cliente SSH.

#### Em distribuições baseadas em Debian/Ubuntu:

```bash
sudo apt-get update
sudo apt-get install openssh-server
```

### Instalação do Cliente SSH

O cliente SSH já vem pré-instalado na maioria das distribuições Linux. Se não estiver disponível, use os seguintes comandos:

#### Debian/Ubuntu:

```bash
sudo apt-get install openssh-client
```

## Autenticação via SSH

Existem duas formas principais de autenticação no SSH: **por senha** e **por chave pública/privada**.

### Autenticação por Senha

A autenticação por senha é o método mais simples e comum. Basta fornecer o nome de usuário e a senha para se conectar ao servidor remoto.

#### Passo a Passo:

1. No cliente, use o comando básico SSH para se conectar a um servidor:

```bash
ssh usuario@servidor
```

**Exemplo**:

```bash
ssh victor@192.168.1.10
```

2. Você será solicitado a inserir a senha do usuário `victor` no servidor `192.168.1.10`.

3. Uma vez autenticado com sucesso, você terá acesso à linha de comando do servidor remoto.

### Autenticação por Chave Pública e Privada

A autenticação por chave pública é mais segura e prática que a autenticação por senha. Ela utiliza um par de chaves: uma chave pública e uma chave privada. A chave pública é colocada no servidor, e a chave privada permanece no cliente. Ao tentar se conectar, o servidor verifica se a chave privada corresponde à chave pública autorizada.

#### Passo a Passo para Gerar Chaves e Configurar Autenticação

1. No cliente, gere um par de chaves (pública e privada) usando o **ssh-keygen**:

```bash
ssh-keygen -t rsa -b 4096
```

**Explicação**:

- **`-t rsa`**: Especifica o tipo de chave (RSA).
- **`-b 4096`**: Gera uma chave com 4096 bits para maior segurança.

2. Quando solicitado, escolha o caminho padrão (`~/.ssh/id_rsa`) para salvar a chave. Se preferir, você pode escolher um nome diferente.

3. Copie a chave pública para o servidor usando o comando **ssh-copy-id**:

```bash
ssh-copy-id usuario@servidor
```

**Exemplo**:

```bash
ssh-copy-id victor@192.168.1.10
```

Esse comando adiciona a chave pública ao arquivo **~/.ssh/authorized_keys** do servidor, permitindo que você faça login sem senha.

4. Agora, ao tentar se conectar novamente, o SSH usará a chave privada para autenticar:

```bash
ssh usuario@servidor
```

Se a chave privada estiver protegida por senha, você será solicitado a inseri-la.

### Desabilitando Autenticação por Senha

Para melhorar a segurança, você pode desabilitar a autenticação por senha e permitir apenas a autenticação por chave pública. Isso pode ser feito editando o arquivo **/etc/ssh/sshd_config** no servidor.

1. Edite o arquivo **sshd_config**:

```bash
sudo nano /etc/ssh/sshd_config
```

2. Encontre as seguintes linhas e modifique-as:

```bash
PasswordAuthentication no
PubkeyAuthentication yes
```

3. Reinicie o serviço SSH para aplicar as mudanças:

```bash
sudo systemctl restart sshd
```

Com isso, o servidor SSH não aceitará mais autenticação por senha, apenas via chave pública.

## Configurações do SSHD (sshd_config)

O arquivo de configuração **/etc/ssh/sshd_config** no servidor é onde você pode ajustar as opções de segurança e desempenho do servidor SSH.

### Opções Comuns no sshd_config

Aqui estão algumas configurações comuns que você pode ajustar no arquivo **sshd_config**:

#### **PermitRootLogin**

Por motivos de segurança, é recomendável desabilitar o login SSH diretamente como root. Isso pode ser feito com a seguinte configuração:

```bash
PermitRootLogin no
```

Se precisar permitir o login como root temporariamente, você pode definir como `yes`, mas isso é um risco de segurança.

#### **PasswordAuthentication**

Para desabilitar a autenticação por senha e usar apenas autenticação por chave pública:

```bash
PasswordAuthentication no
```

#### **PubkeyAuthentication**

Ativa a autenticação por chave pública:

```bash
PubkeyAuthentication yes
```

#### **MaxAuthTries**

Define o número máximo de tentativas de autenticação permitidas. Isso pode ser ajustado para reduzir a vulnerabilidade a ataques de força bruta:

```bash
MaxAuthTries 3
```

#### **AllowUsers e DenyUsers**

Para permitir ou negar o acesso a usuários específicos, use as diretivas **AllowUsers** e **DenyUsers**. Por exemplo:

```bash
AllowUsers victor pedro@192.168.1.*
```

Isso permite que apenas o usuário `victor` e o usuário `pedro` (somente da sub-rede `192.168.1.*`) façam login.

#### **AllowGroups e DenyGroups**

Você também pode permitir ou negar grupos inteiros:

```bash
AllowGroups sshusers
```

Isso permite que apenas os usuários no grupo `sshusers` façam login via SSH.

### Desabilitar Autenticação de Senha para Root

Para aumentar a segurança, é comum desabilitar a autenticação de senha para o usuário **root**, enquanto ainda permite a autenticação por chave pública.

No arquivo **/etc/ssh/sshd_config**, defina:

```bash
PermitRootLogin prohibit-password
```

Isso permitirá que o **root** faça login apenas com chaves, e não com senhas.

### Alterar a Porta SSH

Para adicionar uma camada extra de segurança, é uma prática comum mudar a porta padrão do SSH (**22**) para outra porta não padrão. No arquivo **sshd_config**, altere a linha:

```bash
Port 2222
```

Isso mudará a porta SSH para **2222**. Não se esqueça de atualizar as regras de firewall para permitir o tráfego nesta nova porta e reiniciar o serviço SSH:

```bash
sudo systemctl restart sshd
```

## Transferência de Arquivos via SSH

Além de permitir o acesso remoto, o SSH permite a transferência de arquivos com segurança. Existem dois comandos comuns para isso: **SCP** e **SFTP**.

### SCP (Secure Copy)

O **SCP** permite copiar arquivos de forma segura entre o cliente e o servidor.

**Exemplo para copiar um arquivo do cliente para o servidor**:

```bash
scp arquivo.txt usuario@servidor:/caminho/destino/
```

**Exemplo para copiar um arquivo do servidor para o cliente**:

```bash
scp usuario@servidor:/caminho/arquivo.txt /caminho/local/
```

### SFTP (Secure File Transfer Protocol)

O **SFTP** é uma versão segura do FTP e funciona sobre o SSH. Ele permite navegar pelos diretórios e transferir arquivos de forma interativa.

1. Conecte-se ao servidor SFTP:

```bash
sftp usuario@servidor
```

2. Navegue pelos diretórios e use comandos como `put` para enviar arquivos e `get` para baixar arquivos.
