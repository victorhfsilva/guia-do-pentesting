# Nmap 

## Introdução

O Nmap (Network Mapper) é uma ferramenta de código aberto usada para descoberta de rede e auditoria de segurança. É amplamente utilizado por profissionais de segurança da informação para realizar varreduras de rede e identificar hosts, portas abertas e serviços em execução. 

## Instalação

### Linux

No Linux, o Nmap pode ser instalado diretamente dos repositórios oficiais da distribuição. Por exemplo, em sistemas baseados em Debian (como Ubuntu), você pode usar o comando:

```bash
sudo apt-get install nmap
```

### Windows

No Windows, você pode baixar o instalador do Nmap no site oficial: [https://nmap.org/download.html](https://nmap.org/download.html)

### macOS

No macOS, o Nmap pode ser instalado usando o Homebrew:

```bash
brew install nmap
```

## Conceitos Básicos

### Sintaxe

A sintaxe básica do Nmap é:

```bash
nmap [opções] <alvo>
```
- **opções**: parâmetros que determinam o tipo de varredura.
- **alvo**: pode ser um endereço IP, uma faixa de IPs, ou um nome de domínio.

### Varredura Simples

Para realizar uma varredura simples em um único host:

```bash
nmap 192.168.1.1
```
Este comando verifica as portas mais comuns no host 192.168.1.1.

## Tipos de Varredura

### Varredura de Portas

Para realizar uma varredura completa de portas (1-65535):

```bash
nmap -p 1-65535 192.168.1.1
```

### Varredura TCP SYN (Stealth Scan)

A varredura TCP SYN é a mais comum e rápida. Pode ser usada da seguinte forma:

```bash
nmap -sS 192.168.1.1
```

### Varredura UDP

Para varrer portas UDP:

```bash
nmap -sU 192.168.1.1
```

### Varredura de Versão

Para identificar a versão dos serviços em execução:

```bash
nmap -sV 192.168.1.1
```

### Varredura de Sistema Operacional

Para identificar o sistema operacional do alvo:

```bash
nmap -O 192.168.1.1
```

### Varredura do Protocolo IP

Determina quais protocolos IP são suportados no alvo:

```bash
nmap –sO 192.168.1.1
```

### Varredura de Rede

Para varrer uma faixa de IPs:

```bash
nmap 192.168.1.0/24
```

### Varredura Agressiva

- **Detecção de Versão**: Identifica as versões dos serviços em execução nas portas abertas.
- **Detecção de Sistema Operacional**: Tenta determinar o sistema operacional do alvo.
- **Script NSE**: Executa alguns scripts padrão do Nmap Scripting Engine (NSE) que são úteis em varreduras agressivas.
- **Traceroute**: Realiza um traceroute para descobrir o caminho que os pacotes tomam até o alvo.

```bash
nmap -A 192.168.1.1
```

## Varredura Rápida

- Em vez de verificar todas as 65535 portas TCP, a varredura rápida verifica apenas as portas mais comuns (cerca de 100).

```
nmap -F 192.168.1.1
```

## Varredura de portas TCP Ack

- Detecta o estado de um firewall e verifica se as portas estão filtradas.
- Diferencia entre portas abertas/fechadas e portas filtradas.

```bash
nmap -sA 192.168.1.1
```


## Opções Úteis

### Salvando Resultados

Para salvar os resultados em um arquivo:

```bash
nmap -oN resultado.txt 192.168.1.1
```

### Varredura em Modo Verbo

Para obter mais detalhes durante a varredura:

```bash
nmap -v 192.168.1.1
```

### Desativando a verificação de ping

- O parâmetro `-PN` (anteriormente `-P0`) desativa a verificação de ping.
- Realiza varreduras em alvos sem verificar se eles estão ativos.
- Útil para varreduras em redes que bloqueiam pacotes de ping.

```bash
nmap -PN 192.168.1.1
```

## Razão do estado de cada porta

- Fornece informações detalhadas sobre a justificativa do Nmap para o estado das portas.
- Útil para depuração e análise detalhada dos resultados da varredura.

```bash
nmap --reason 192.168.1.1
```

### Agressividade
- Os parâmetros `-T1` a `-T5` controlam a agressividade do tempo de execução da varredura. 

#### Opções
- **-T0: Paranoid**
  - Muito lento, usado para evitar detecção. Adequado para varreduras em redes muito restritas.
  
- **-T1: Sneaky**
  - Lento, reduz a chance de detecção. Útil quando a prioridade é não ser detectado.
  
- **-T2: Polite**
  - Moderadamente lento, reduz a carga na rede e diminui a chance de detecção.

- **-T3: Normal**
  - Tempo padrão do Nmap. Balanceia velocidade e stealth.

- **-T4: Aggressive**
  - Rápido, pode gerar mais tráfego e ser detectado mais facilmente. Bom para varreduras em redes menos restritas.

- **-T5: Insane**
  - Muito rápido, gera muito tráfego e tem alta chance de detecção. Usado em redes onde a velocidade é crucial e a detecção não é uma preocupação.

```bash
nmap -T4 192.168.1.1
```

## Scripts NSE (Nmap Scripting Engine)

O Nmap inclui um poderoso motor de scripts (NSE) que permite a execução de scripts personalizados para realizar várias tarefas. Por exemplo, para detectar vulnerabilidades conhecidas:

```bash
nmap --script vuln 192.168.1.1
```

## Lista de Interfaces

- O parâmetro `-iflist` exibe a lista de interfaces e rotas de rede disponíveis no sistema.
- Fornece uma visão detalhada das interfaces de rede (por exemplo, Ethernet, Wi-Fi) e as rotas de rede configuradas no sistema.
- Útil para verificar a configuração da rede antes de iniciar uma varredura.

```bash
nmap --iflist
```
