# **Snort**

## Introdução

**Snort** é uma ferramenta de Intrusion Detection System (IDS) e Intrusion Prevention System (IPS) altamente popular e amplamente utilizada para monitoramento de redes, detecção de ataques e respostas a ameaças. Desenvolvido inicialmente pela Sourcefire (hoje parte da Cisco), o Snort pode analisar o tráfego de rede em tempo real e identificar atividades suspeitas com base em regras definidas pelo usuário.

O Snort é flexível e poderoso, funcionando como IDS (apenas monitorando e alertando sobre ataques) ou IPS (bloqueando atividades maliciosas em tempo real). Ele é utilizado por administradores de rede, profissionais de segurança e pentesters para proteger infraestruturas de rede contra uma ampla gama de ataques, incluindo varreduras de porta, tentativas de exploração, negação de serviço (DoS), entre outros.

## Características do Snort

- **Detecção de Intrusões em Tempo Real**: Monitora o tráfego de rede e identifica atividades suspeitas com base em assinaturas de ataques conhecidos.
- **Modos Flexíveis**: Pode operar em três modos: Sniffer (captura pacotes), Packet Logger (armazena pacotes), e Network Intrusion Detection (detecção de intrusões).
- **Baseado em Regras**: Permite criar e personalizar regras para detectar padrões específicos de tráfego malicioso.
- **Integração com IPS**: Pode ser configurado para bloquear ativamente tráfego malicioso.
- **Compatibilidade com Diversos Protocolos**: Suporta uma ampla gama de protocolos, incluindo TCP, UDP, ICMP, e muitos outros.

## Instalação do Snort

A instalação do Snort pode variar um pouco dependendo da distribuição Linux que você está usando. Abaixo estão as instruções de instalação para algumas das distribuições mais comuns.

### Instalação no Debian/Ubuntu

Antes de instalar o Snort, certifique-se de que seu sistema está atualizado:

```bash
sudo apt-get update
sudo apt-get upgrade
```

Agora, instale o Snort com o comando:

```bash
sudo apt-get install snort
```

Durante a instalação, você será solicitado a configurar algumas opções básicas, como a interface de rede que o Snort deve monitorar.

### Instalação no CentOS/RHEL

Para CentOS e RHEL, você precisará habilitar o EPEL (Extra Packages for Enterprise Linux) antes de instalar o Snort:

```bash
sudo yum install epel-release
sudo yum install snort
```

### Instalação no Arch Linux

No Arch Linux, você pode instalar o Snort com:

```bash
sudo pacman -S snort
```

### Verificação da Instalação

Após a instalação, você pode verificar se o Snort foi instalado corretamente e está funcionando com o comando:

```bash
snort -V
```

Isso deve mostrar a versão do Snort instalada no sistema.

## Configuração Básica do Snort

Depois de instalar o Snort, é necessário configurá-lo para que funcione corretamente em sua rede. As principais configurações do Snort são definidas no arquivo `snort.conf`, geralmente localizado em `/etc/snort/snort.conf` ou `/etc/snort/`.

### Editando o Arquivo de Configuração `snort.conf`

Abra o arquivo de configuração com um editor de texto:

```bash
sudo nano /etc/snort/snort.conf
```

Dentro deste arquivo, você encontrará várias seções importantes que precisam ser configuradas:

#### Configurando a Rede de Monitoramento

Localize as linhas que definem as variáveis de rede, como `HOME_NET` e `EXTERNAL_NET`. A variável `HOME_NET` deve ser configurada para a rede que você deseja monitorar.

Exemplo:

```plaintext
var HOME_NET 192.168.1.0/24
var EXTERNAL_NET any
```

Essa configuração indica que o Snort monitorará a rede local `192.168.1.0/24` e considerará todo o tráfego externo como `EXTERNAL_NET`. Caso deseje monitorar apenas um endereço basta utilizar `192.168.1.2/32`.

#### Configurando o Caminho das Regras

O Snort usa regras para detectar ataques e comportamentos suspeitos. No arquivo de configuração, é necessário definir o caminho onde essas regras estão localizadas:

```plaintext
var RULE_PATH /etc/snort/rules
```

Certifique-se de que o diretório especificado existe e contém as regras necessárias.

#### Configurando Saídas (Output)

As saídas configuram como o Snort reportará os alertas. A configuração mais comum é usar o formato de alerta padrão:

```plaintext
output alert_fast: stdout
```

Esse comando envia alertas para o terminal, mas o Snort pode ser configurado para salvar logs em arquivos ou enviar dados para outras ferramentas de monitoramento.

### Atualizando e Adicionando Regras

O Snort usa arquivos de regras para identificar tráfego malicioso. Você pode baixar regras da comunidade ou criar suas próprias regras personalizadas.

#### Baixando Regras da Comunidade

Regras da comunidade podem ser baixadas diretamente do site do Snort. A maneira mais comum de fazer isso é usando o `pulledpork`, uma ferramenta que automatiza o download e a atualização das regras.

Para instalar o pulledpork e atualizar suas regras, siga as instruções no [repositório oficial do PulledPork](https://github.com/shirkdog/pulledpork).

### Testando o Snort

Após configurar o Snort, é importante testá-lo para garantir que está funcionando corretamente.

#### Testando a Configuração

Use o seguinte comando para verificar a configuração do Snort:

```bash
sudo snort -T -c /etc/snort/snort.conf -i eth0
```

- `-T`: Testa a configuração sem iniciar o monitoramento.
- `-c`: Especifica o arquivo de configuração.
- `-i`: Especifica a interface de rede.

Se não houver erros, o Snort está configurado corretamente.

#### Iniciando o Snort

Para iniciar o Snort no modo de detecção de intrusão (IDS):

```bash
sudo snort -c /etc/snort/snort.conf -i eth0
```

Isso iniciará o Snort e ele começará a monitorar a interface `eth0` usando as regras definidas.

## Modos de Operação do Snort

O Snort pode operar em diferentes modos, dependendo do que você deseja realizar:

### Modo Sniffer

No modo Sniffer, o Snort captura e exibe pacotes em tempo real. Este modo é útil para visualizar o tráfego de rede sem realizar nenhuma análise ou detecção.

```bash
sudo snort -i eth0 -v
```

- `-v`: Mostra os pacotes capturados em tempo real.

### Modo Packet Logger

No modo Packet Logger, o Snort grava todos os pacotes capturados em um arquivo para análise posterior. Este modo é ideal para auditorias de tráfego.

```bash
sudo snort -i eth0 -l /var/log/snort
```

- `-l`: Especifica o diretório onde os pacotes serão salvos.

### Modo IDS/IPS

No modo IDS/IPS, o Snort monitora o tráfego e compara com suas regras de detecção, gerando alertas ou bloqueando pacotes conforme configurado.

```bash
sudo snort -c /etc/snort/snort.conf -i eth0
```

Este modo é o mais utilizado para detecção e prevenção de intrusões em redes.

## Criando Regras Personalizadas no Snort

Criar regras personalizadas é uma das funcionalidades mais poderosas do Snort, permitindo que você configure o sistema para detectar ataques específicos. A estrutura básica de uma regra do Snort é:

```plaintext
<ação> <protocolo> <origem> <porta> -> <destino> <porta> (<opções>)
```

### Exemplo de Regra

Uma regra para detectar um scan de porta TCP poderia ser escrita assim:

```plaintext
alert tcp any any -> $HOME_NET 80 (msg:"Port scan detected"; sid:1000002; rev:1;)
```

- `alert tcp`: Gera um alerta para tráfego TCP.
- `any any`: Qualquer endereço IP e porta de origem.
- `-> $HOME_NET 80`: Para a rede definida como `HOME_NET` na porta 80.
- `msg:"Port scan detected"`: Mensagem que será exibida quando a regra for acionada.

### Testando Regras Personalizadas

Depois de adicionar uma nova regra, teste o Snort novamente para garantir que a configuração está correta e a regra funciona como esperado:

```bash
sudo snort -T -c /etc/snort/snort.conf -i eth0
```

Se tudo estiver funcionando corretamente, o Snort estará pronto para detectar a condição especificada na regra.

Aqui estão os tópicos explicativos sobre os parâmetros `-A`, `-q`, e `-h` do Snort:

### **Modo de Alerta**

O parâmetro `-A` define o modo de alerta que o Snort usará para exibir ou registrar alertas gerados durante a execução. Ele controla como os alertas são formatados e exibidos, proporcionando diferentes níveis de detalhamento para análise. Os modos mais comuns incluem:

- **`-A fast`**: Gera alertas de forma resumida, exibindo apenas informações básicas como o tipo de alerta e os endereços de origem e destino. Esse modo é ideal para quando se deseja um log mais compacto.
  
- **`-A full`**: Exibe alertas completos, incluindo cabeçalhos de pacotes e detalhes adicionais sobre a detecção. Esse modo é útil para análise aprofundada de incidentes.

- **`-A console`**: Exibe os alertas diretamente no console (terminal), ideal para monitoramento em tempo real.

- **`-A none`**: Desativa os alertas, útil quando o Snort é configurado apenas para capturar pacotes sem análise.

**Exemplo de Uso:**

```bash
sudo snort -c /etc/snort/snort.conf -i eth0 -A fast
```

Esse comando inicia o Snort com a configuração padrão, mas com alertas em formato resumido.

### **Modo Silencioso**

O parâmetro `-q` ativa o modo silencioso, reduzindo a quantidade de informações exibidas no terminal. Este modo é particularmente útil para execução em segundo plano ou quando o Snort é executado como serviço, minimizando as mensagens de log no console. Em ambientes de produção, isso ajuda a reduzir o ruído e melhorar o desempenho do sistema.

- **Uso Comum**: Ideal para scripts de automação ou execução contínua onde as informações de execução padrão não são necessárias.

**Exemplo de Uso:**

```bash
sudo snort -c /etc/snort/snort.conf -i eth0 -q
```

Esse comando inicia o Snort no modo silencioso, executando sem exibir informações no console.

### **Especificação da Rede Doméstica**

O parâmetro `-h` é usado para definir a "Home Network" (rede doméstica) que o Snort deve proteger ou monitorar. Essa configuração é crucial, pois determina qual tráfego o Snort considerará como sendo interno (HOME_NET) e qual será externo (EXTERNAL_NET). Essa distinção permite ao Snort aplicar regras de forma mais eficaz, diferenciando o tráfego legítimo de possíveis ataques.

- **Uso Comum**: Defina a rede que você deseja monitorar. Isso deve coincidir com a configuração `HOME_NET` no arquivo `snort.conf`.

**Exemplo de Uso:**

```bash
sudo snort -c /etc/snort/snort.conf -i eth0 -h 192.168.1.0/24
```

Esse comando configura o Snort para monitorar a rede `192.168.1.0/24` como sua rede doméstica.

## Considerações de Uso e Boas Práticas

1. **Atualize Regularmente as Regras**: Mantenha suas regras atualizadas para se proteger contra novas ameaças.
   
2. **Teste Regras Personalizadas**: Sempre teste suas regras personalizadas para evitar falsos positivos ou negativos.

3. **Monitoramento Contínuo**: Configure o Snort para rodar continuamente, especialmente em ambientes de produção, para garantir que as ameaças sejam detectadas em tempo real.

4. **Integração com Ferramentas de Análise**: Integre o Snort com outras ferramentas de SIEM (Security Information and Event Management) para análises mais profundas e respostas automatizadas.

5. **Ajuste de Regras para Minimizar Falsos Positivos**: Ajuste suas regras e refine os parâmetros para evitar alertas falsos que podem sobrecarregar sua equipe de segurança.
