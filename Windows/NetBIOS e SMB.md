# NetBIOS e SMB no Windows

## Introdução

**NetBIOS (Network Basic Input/Output System)** e **SMB (Server Message Block)** são protocolos essenciais para compartilhamento de arquivos, impressoras e recursos de rede no ambiente Windows. Eles desempenham um papel fundamental na comunicação entre dispositivos Windows em uma rede local.

- **NetBIOS** é um protocolo de rede legado que permite que aplicativos em diferentes computadores na rede local comuniquem-se uns com os outros. Ele fornece serviços de nome, sessão e datagrama.
- **SMB** é o protocolo utilizado principalmente para compartilhamento de arquivos e impressoras. O SMB permite que você acesse recursos remotos como se estivessem no seu próprio computador.

A interação com esses serviços pode ser realizada através do terminal, utilizando ferramentas nativas do Windows como `nbtstat` e o acesso direto a compartilhamentos SMB via o comando `net use` ou `Explorer`.

## NetBIOS: Funcionamento e Comando `nbtstat`

O **NetBIOS** funciona como um serviço de nomes que permite que os computadores em uma rede local se comuniquem e descubram uns aos outros pelo nome. Ele é usado em conjunto com o protocolo **NetBIOS sobre TCP/IP (NBT)**, que fornece serviços de rede em cima da pilha TCP/IP.

O comando `nbtstat` é uma ferramenta útil para diagnosticar problemas relacionados ao NetBIOS. Ele permite visualizar a tabela de nomes NetBIOS, estatísticas e resolver conflitos de nome de rede.

### Utilizando o `nbtstat`

O comando `nbtstat` é utilizado para diagnosticar e exibir informações sobre conexões NetBIOS, além de resolver nomes de NetBIOS. Aqui estão alguns dos usos mais comuns do comando.

#### Exibir a Tabela de Nomes NetBIOS

A tabela de nomes NetBIOS contém os nomes associados a um determinado dispositivo ou interface de rede. Para exibir a tabela de nomes de um dispositivo remoto ou local, use:

```bash
nbtstat -n
```

Este comando lista os nomes NetBIOS registrados localmente no computador.

#### Exibir Estatísticas de NetBIOS

Para exibir as estatísticas do NetBIOS, que incluem o número de pacotes enviados/recebidos e erros, use:

```bash
nbtstat -s
```

#### Exibir a Tabela de Conexões

Este comando exibe as conexões atuais e suas respectivas estatísticas:

```bash
nbtstat -S
```

#### Exibir a Tabela de Nomes Remotos

Para visualizar a tabela de nomes NetBIOS de um computador remoto, use:

```bash
nbtstat -A <endereço IP>
```

Substitua `<endereço IP>` pelo endereço IP do dispositivo de destino. Esse comando exibe os nomes registrados no dispositivo remoto.

### Usando NetBIOS e SMB para Acessar Compartilhamentos

NetBIOS é usado principalmente para resolver nomes e identificar dispositivos na rede, enquanto o **SMB** é usado para acessar arquivos, pastas, e impressoras compartilhados em uma rede Windows.

## SMB: Funcionamento e Acesso

O **SMB (Server Message Block)** é o protocolo usado para compartilhar recursos como arquivos e impressoras entre computadores em uma rede. Ele também oferece suporte para comunicação entre processos. O SMB no Windows opera principalmente sobre o protocolo TCP/IP.

Existem duas maneiras principais de acessar recursos SMB no Windows: via **linha de comando** ou **explorador de arquivos**.

### Acessando Compartilhamentos SMB via Terminal

Você pode usar o comando `net use` para montar ou acessar compartilhamentos SMB diretamente no terminal do Windows.

#### Visualizando um Compartilhamento SMB

Para visualizar os compartilhamento de arquivos de um host, use o seguinte comando:

```bash
net view Z: \\<endereço IP>
```

#### Montando um Compartilhamento SMB

Para acessar um compartilhamento de arquivos remoto via SMB e montá-lo como uma unidade de rede, use o seguinte comando:

```bash
net use Z: \\<endereço IP>\<compartilhamento> /user:<usuário> <senha>
```

**Explicação:**

- **`Z:`**: A letra da unidade que será atribuída ao compartilhamento.
- **`\\<endereço IP>\<compartilhamento>`**: O endereço IP do servidor SMB e o nome do compartilhamento.
- **`/user:<usuário>`**: O nome de usuário que tem permissão para acessar o compartilhamento.
- **`<senha>`**: A senha correspondente ao usuário.

**Exemplo:**

```bash
net use Z: \\192.168.1.10\Public /user:admin password123
```

Esse comando conecta o compartilhamento `Public` do servidor `192.168.1.10` como a unidade `Z:` e utiliza o usuário `admin` com a senha `password123`.

####  Desconectar um Compartilhamento

Para desconectar um compartilhamento montado, use o seguinte comando:

```bash
net use Z: /delete
```

Isso remove o compartilhamento da unidade `Z:`.

### Acessando Compartilhamentos SMB via Explorer

Se você preferir usar a interface gráfica, também pode acessar os compartilhamentos diretamente no **Explorador de Arquivos** do Windows:

1. Abra o **Explorador de Arquivos**.
2. Na barra de endereços, digite o endereço do compartilhamento SMB no formato `\\<endereço IP>\<compartilhamento>` e pressione **Enter**.
   
   **Exemplo:** `\\192.168.1.10\Public`
   
3. Se necessário, você será solicitado a fornecer credenciais (nome de usuário e senha) para acessar o compartilhamento.

### Explorando o Serviço SMB

O protocolo SMB pode ser explorado de várias maneiras para auditoria e verificação de segurança. Ferramentas como **Nmap** e **Metasploit** podem ser usadas para detectar e explorar vulnerabilidades no SMB, como no caso da vulnerabilidade **EternalBlue** (CVE-2017-0144) que afeta o SMBv1.

Você também pode testar versões e configurações de SMB com o comando **Nmap**:

```bash
nmap --script smb-os-discovery -p445 <endereço IP>
```

Esse comando descobre o sistema operacional remoto e a versão do SMB em execução na máquina.

## Boas Práticas para Gerenciar SMB e NetBIOS

1. **Desative SMBv1**: O SMBv1 é uma versão antiga do protocolo e vulnerável a vários ataques, como o WannaCry. Verifique se o SMBv1 está desativado no seu sistema.
   
   Para desativar o SMBv1 no Windows, execute o seguinte comando no PowerShell como administrador:

   ```bash
   Disable-WindowsOptionalFeature -Online -FeatureName "SMB1Protocol"
   ```

2. **Segurança de Senhas**: Sempre use senhas fortes para proteger seus compartilhamentos SMB. Não compartilhe pastas sem senhas, especialmente em redes públicas.

3. **Limite Acesso**: Controle o acesso a seus compartilhamentos SMB, limitando-o a usuários específicos ou grupos.

4. **Monitore o Tráfego**: Use ferramentas de monitoramento de rede para verificar o tráfego SMB e NetBIOS em sua rede para identificar atividades suspeitas.
