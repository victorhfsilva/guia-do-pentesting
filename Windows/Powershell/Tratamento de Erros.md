# Tratamento de Erros no PowerShell

O tratamento de erros no PowerShell é fundamental para criar scripts robustos e confiáveis. Usar blocos de controle como `try`, `catch` e `finally`, e entender a diferença entre erros termináveis e não-termináveis, ajuda a garantir que seus scripts lidem corretamente com falhas e exceções, melhorando sua estabilidade.


### Tratamento de Exceções com `Try`, `Catch` e `Finally`

O PowerShell oferece a estrutura `try`, `catch` e `finally` para capturar e lidar com erros de forma controlada. Essa estrutura é similar a outras linguagens de programação e permite que você manipule exceções, execute ações corretivas ou de limpeza, e garanta que partes críticas do código sejam executadas independentemente de ocorrerem erros.

#### Bloco `Try`

O bloco `try` contém o código que você deseja monitorar em busca de erros. Se ocorrer um erro dentro do bloco `try`, o PowerShell interrompe a execução do código e procura um bloco `catch` correspondente para lidar com a exceção.

##### Exemplo de uso básico de `try`:
```powershell
try {
    # Código que pode gerar um erro
    $number = 10 / 0
}
```

#### Bloco `Catch`

O bloco `catch` é executado quando um erro ou exceção é encontrado no bloco `try`. Você pode especificar o que deve ser feito quando um erro é capturado, como registrar a exceção, exibir uma mensagem ou tomar medidas corretivas.

##### Exemplo de uso básico de `catch`:
```powershell
try {
    # Código que pode gerar um erro
    $number = 10 / 0
} catch {
    # Capturar e lidar com o erro
    Write-Host "Um erro ocorreu: $_"
}
```
Neste exemplo, se ocorrer um erro no bloco `try` (neste caso, divisão por zero), o PowerShell executa o bloco `catch`, que exibe a mensagem de erro. O `$_` é uma variável automática que contém detalhes sobre o erro capturado.

#### Bloco `Finally`

O bloco `finally` é opcional e contém código que será executado independentemente de o erro ter ocorrido ou não. Ele é útil para ações de limpeza, como fechar conexões de banco de dados ou liberar recursos.

##### Exemplo completo com `finally`:
```powershell
try {
    # Código que pode gerar um erro
    $number = 10 / 0
} catch {
    # Capturar o erro
    Write-Host "Erro: Divisão por zero."
} finally {
    # Código de limpeza
    Write-Host "Execução concluída."
}
```
Mesmo que ocorra um erro, o bloco `finally` será executado.

#### Especificar Exceções no Bloco `Catch`

Você pode capturar exceções específicas no bloco `catch`, fornecendo tipos de erro como filtros. Isso é útil quando você deseja tratar diferentes tipos de erros de maneiras distintas.

##### Exemplo:
```powershell
try {
    $file = Get-Content "arquivo_que_nao_existe.txt"
} catch [System.IO.FileNotFoundException] {
    Write-Host "Arquivo não encontrado."
} catch {
    Write-Host "Outro erro ocorreu: $_"
}
```
Neste exemplo, se um erro específico de arquivo não encontrado for lançado, ele será capturado pelo primeiro bloco `catch`. Se qualquer outro tipo de erro ocorrer, o segundo bloco `catch` será executado.

---

### Erros Termináveis vs Não-Termináveis

No PowerShell, os erros podem ser classificados em **termináveis** e **não-termináveis**.

#### Erros Termináveis

Erros termináveis são erros críticos que interrompem a execução do script ou do comando. Eles acionam automaticamente o bloco `catch`, caso o erro ocorra dentro de um bloco `try`. A maioria das exceções lançadas explicitamente são erros termináveis.

##### Exemplo de erro terminável:
```powershell
try {
    # Tentativa de abrir um arquivo que não existe
    Get-Content "arquivo_inexistente.txt"
} catch {
    Write-Host "Erro terminável capturado: $_"
}
```
Se o arquivo não existir, o erro será tratado no bloco `catch`.

#### Erros Não-Termináveis

Erros não-termináveis são erros mais leves que não interrompem a execução do comando ou script. Eles podem ser registrados, mas o script continua executando. O PowerShell não captura erros não-termináveis automaticamente no bloco `catch`.

##### Exemplo de erro não-terminável:
```powershell
# Tentativa de excluir um arquivo protegido
Remove-Item "C:\arquivo_protegido.txt"
```
Se o arquivo estiver protegido contra exclusão, o PowerShell exibe um erro, mas o comando continua executando.

##### Lidando com erros não-termináveis:
Para capturar e tratar erros não-termináveis em um bloco `catch`, é necessário definir o modo de preferência de erro como `"Stop"`, forçando o erro a ser tratado como terminável.

##### Exemplo:
```powershell
try {
    # Configurar erro não-terminável para ser tratado como terminável
    $ErrorActionPreference = "Stop"
    Remove-Item "C:\arquivo_protegido.txt"
} catch {
    Write-Host "Erro não-terminável tratado como terminável: $_"
} finally {
    # Restaurar configuração padrão
    $ErrorActionPreference = "Continue"
}
```
Aqui, o `ErrorActionPreference` foi temporariamente definido como `"Stop"` para garantir que o erro seja capturado no bloco `catch`.
