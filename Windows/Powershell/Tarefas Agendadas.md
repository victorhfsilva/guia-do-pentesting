# Automação com Tarefas Agendadas no PowerShell

Automatizar tarefas usando o Agendador de Tarefas do Windows é uma prática comum para administrar sistemas de maneira eficiente. O PowerShell pode ser usado para criar, gerenciar e agendar tarefas automaticamente, facilitando a execução de scripts em horários definidos, garantindo assim uma automação eficiente.

### Criar Tarefas Agendadas com PowerShell

O Windows fornece o Agendador de Tarefas (Task Scheduler) para executar scripts ou programas em horários ou eventos específicos. Com o PowerShell, você pode criar tarefas agendadas utilizando cmdlets como `New-ScheduledTaskTrigger`, `Register-ScheduledTask`, e `Set-ScheduledTask`.
####  Compreendendo os Componentes de uma Tarefa Agendada

Uma tarefa agendada no Windows é composta de:

- **Gatilho (Trigger)**: Quando a tarefa será executada (horários, intervalos, eventos, etc.).
- **Ação (Action)**: O que será executado (scripts, programas, etc.).
- **Condições (Conditions)**: Condições especiais para a execução da tarefa, como se o computador está ocioso.
- **Configurações (Settings)**: Opções como comportamento em falhas e tempo máximo de execução.


### Criando uma Tarefa Agendada Básica

Vamos criar um exemplo de tarefa agendada que executa um script em um horário definido usando PowerShell.

#### Passos para Criar uma Tarefa Agendada:

1. **Criar um Gatilho (Trigger)**
2. **Definir uma Ação (Action)**
3. **Registrar a Tarefa com o Agendador de Tarefas (Register-ScheduledTask)**

#### Criando um Gatilho com `New-ScheduledTaskTrigger`

O cmdlet `New-ScheduledTaskTrigger` cria um "gatilho", ou seja, define quando a tarefa será executada. Pode ser configurado para agendar tarefas diárias, semanais ou uma única vez.

##### Exemplo de criar um gatilho que executa diariamente às 9h:
```powershell
# Criar um gatilho que executa a tarefa diariamente às 9h
$gatilho = New-ScheduledTaskTrigger -Daily -At 9:00AM
```

#### Definindo uma Ação com `New-ScheduledTaskAction`

O cmdlet `New-ScheduledTaskAction` define a ação a ser executada pela tarefa. Pode ser um script PowerShell, um arquivo executável ou qualquer outro comando.

##### Exemplo de ação que executa um script PowerShell:
```powershell
# Definir uma ação que executa um script PowerShell
$acao = New-ScheduledTaskAction -Execute "powershell.exe" -Argument "C:\Scripts\MeuScript.ps1"
```

#### Registrando a Tarefa com `Register-ScheduledTask`

O cmdlet `Register-ScheduledTask` é usado para registrar a tarefa no Agendador de Tarefas, combinando o gatilho e a ação definidos anteriormente.

##### Exemplo de registro de uma tarefa:
```powershell
# Registrar a tarefa agendada
Register-ScheduledTask -Action $acao -Trigger $gatilho -TaskName "MinhaTarefaDiaria" -Description "Executa meu script diariamente às 9h"
```

Neste exemplo, a tarefa será registrada com o nome "MinhaTarefaDiaria" e executará o script `MeuScript.ps1` todos os dias às 9h.

---

###  Configurações Adicionais para Tarefas Agendadas

Você pode adicionar configurações e condições adicionais à sua tarefa agendada, como definir que a tarefa deve ser executada mesmo que o usuário não esteja logado, configurar repetições, ou definir um período máximo de execução.

#### Configurações com `New-ScheduledTaskSettingsSet`

`New-ScheduledTaskSettingsSet` define configurações como o tempo máximo de execução ou a opção de reiniciar a tarefa após uma falha.

##### Exemplo: Configurando para rodar a tarefa mesmo que o usuário não esteja logado
```powershell
# Definir configurações adicionais
$configuracao = New-ScheduledTaskSettingsSet -AllowStartIfOnBatteries -DontStopIfGoingOnBatteries

# Registrar a tarefa com as configurações
Register-ScheduledTask -Action $acao -Trigger $gatilho -TaskName "MinhaTarefaDiaria" -Settings $configuracao -User "Administrador" -Password "SenhaSegura"
```
---

### Gerenciando e Monitorando Tarefas Agendadas

Depois de criar a tarefa agendada, você pode usar cmdlets do PowerShell para gerenciá-la, modificar suas configurações ou removê-la.

#### Listar Tarefas Agendadas

Para listar todas as tarefas agendadas no sistema:
```powershell
# Listar todas as tarefas agendadas
Get-ScheduledTask
```

#### Ver Detalhes de uma Tarefa Específica

Para exibir detalhes de uma tarefa específica:
```powershell
# Ver detalhes de uma tarefa agendada
Get-ScheduledTask -TaskName "MinhaTarefaDiaria"
```

#### Modificar uma Tarefa Agendada

Para modificar uma tarefa existente, você pode usar o cmdlet `Set-ScheduledTask`.

##### Exemplo:
```powershell
# Modificar a tarefa para rodar às 10h em vez de 9h
$gatilhoNovo = New-ScheduledTaskTrigger -Daily -At 10:00AM
Set-ScheduledTask -TaskName "MinhaTarefaDiaria" -Trigger $gatilhoNovo
```

#### Remover uma Tarefa Agendada

Para remover uma tarefa agendada:
```powershell
# Remover uma tarefa agendada
Unregister-ScheduledTask -TaskName "MinhaTarefaDiaria" -Confirm:$false
```
