# Protocolo TCP (Transmission Control Protocol)

## Introdução ao Protocolo TCP

O **Transmission Control Protocol (TCP)** é um dos principais protocolos da suíte de protocolos TCP/IP, usado para transmitir dados de forma confiável entre dois dispositivos em uma rede. Ao contrário de protocolos de transporte não orientados à conexão, como o UDP (User Datagram Protocol), o TCP é orientado à conexão, o que significa que ele garante a entrega ordenada e livre de erros dos pacotes de dados.

## Características do TCP

### Orientado à Conexão

- **Definição**: Antes de transmitir dados, o TCP estabelece uma conexão entre os dois dispositivos envolvidos. Isso é feito através de um processo conhecido como **handshake de três vias**.
- **Vantagens**: Garantia de que os dados são entregues na ordem correta e sem duplicações.

### Confiabilidade

- **Confirmação de Recebimento**: O TCP garante que cada pacote de dados enviado é confirmado pelo receptor. Se um pacote não for confirmado, ele será retransmitido.
- **Controle de Erros**: O TCP inclui mecanismos de verificação de erros que garantem a integridade dos dados transmitidos.

### Controle de Fluxo

- **Janela Deslizante (Sliding Window)**: O TCP usa uma técnica de janela deslizante para controlar a quantidade de dados que podem ser enviados antes de precisar de uma confirmação. Isso permite ajustar a velocidade de transmissão com base na capacidade do receptor.
- **Vantagem**: Evita sobrecarregar o receptor com mais dados do que ele pode processar.

### Controle de Congestionamento

- **Definição**: O TCP possui mecanismos para detectar e reagir a congestionamentos na rede. Ele ajusta dinamicamente a taxa de envio de pacotes para evitar sobrecarregar a rede.
- **Técnicas**: Slow Start, Congestion Avoidance, Fast Retransmit, e Fast Recovery.

## Estrutura de um Segmento TCP

Um segmento TCP contém vários campos que transportam informações essenciais para o controle da transmissão de dados:

### Cabeçalho TCP

- **Porta de Origem e Porta de Destino (16 bits cada)**: Identificam as portas de comunicação no dispositivo de origem e no dispositivo de destino.
- **Número de Sequência (32 bits)**: Indica a posição do primeiro byte dos dados neste segmento dentro do fluxo de dados contínuo.
- **Número de Confirmação (32 bits)**: Indica o próximo número de sequência que o remetente espera receber, confirmando o recebimento de dados até esse número.
- **Tamanho do Cabeçalho (4 bits)**: Especifica o tamanho do cabeçalho TCP.
- **Reservado (3 bits)**: Reservado para uso futuro, deve ser zero.
- **Flags (9 bits)**: Incluem indicadores como SYN, ACK, FIN, URG, PSH, RST, entre outros, que controlam o estabelecimento, manutenção e término de conexões.
- **Tamanho da Janela (16 bits)**: Indica o tamanho da janela deslizante, determinando quantos bytes podem ser enviados sem confirmação.
- **Checksum (16 bits)**: Utilizado para verificar a integridade dos dados.
- **Ponteiro Urgente (16 bits)**: Usado se o flag URG estiver ativo, apontando para dados urgentes.
- **Opções (Variável)**: Campo opcional que pode incluir parâmetros adicionais, como o tamanho máximo do segmento (MSS).

### Dados

- **Payload (Dados)**: A carga útil do segmento TCP, que contém os dados reais a serem transmitidos. O tamanho varia de acordo com a aplicação e a configuração da janela.

### Estabelecimento de Conexão TCP

O processo de estabelecimento de uma conexão TCP é conhecido como **handshake de três vias**:

1. **SYN**: O cliente envia um segmento com o flag SYN ativado, solicitando uma conexão e especificando o número de sequência inicial.
2. **SYN-ACK**: O servidor responde com um segmento que tem os flags SYN e ACK ativados, confirmando o recebimento do SYN do cliente e enviando seu próprio número de sequência.
3. **ACK**: O cliente envia um segmento com o flag ACK ativado, confirmando o recebimento do SYN-ACK do servidor. A conexão está agora estabelecida.

### Encerramento de Conexão TCP

O processo de encerramento de uma conexão TCP também envolve a troca de segmentos para garantir que ambos os lados possam terminar a conexão de forma ordenada:

1. **FIN**: Um dos lados (cliente ou servidor) envia um segmento com o flag FIN ativado, solicitando o término da conexão.
2. **FIN-ACK**: O outro lado responde com um segmento que contém os flags FIN e ACK ativados, confirmando o recebimento do FIN e indicando que também deseja encerrar a conexão.
3. **ACK**: O lado que iniciou o término da conexão responde com um segmento ACK final. A conexão está agora encerrada.

### Problemas na Requisição 

O **flag RST (Reset)** no TCP é utilizado para abortar uma conexão de forma abrupta. Quando um segmento com o flag RST é enviado, ele imediatamente encerra a conexão sem a troca ordenada de mensagens como ocorre com os segmentos FIN e ACK. Esse mecanismo é necessário em certas situações, mas pode causar problemas quando usado de forma inesperada ou incorreta.

#### Causas Comuns para o Envio de RST

- **Erro de Configuração**: Pode ocorrer se um dispositivo de rede, como um firewall ou proxy, estiver mal configurado, resultando no envio de pacotes RST para interromper conexões legítimas.
- **Porta Fechada**: Se um segmento TCP for recebido por um dispositivo em uma porta que não está em escuta (ou seja, não há serviço ou aplicação esperando conexões naquela porta), o dispositivo pode responder com um RST para sinalizar que a conexão deve ser encerrada.
- **Conexão Não Reconhecida**: Se um pacote for recebido em uma conexão TCP que não é reconhecida pelo dispositivo de destino (por exemplo, se a conexão já foi encerrada ou nunca existiu), o dispositivo pode enviar um RST.
- **Ataques de Negação de Serviço (DoS)**: Em alguns casos, atacantes podem enviar pacotes RST para forçar o encerramento de conexões legítimas, causando interrupções no serviço.

## Controle de Fluxo e Congestionamento

### Controle de Fluxo

- **Janela Deslizante**: O TCP ajusta a quantidade de dados que podem ser enviados sem confirmação com base na capacidade de recebimento do dispositivo de destino.
- **Evita Sobrecarregamento**: Garante que o remetente não sobrecarregue o receptor com mais dados do que ele pode processar.

### Controle de Congestionamento

- **Slow Start**: O TCP começa a enviar dados lentamente e aumenta a taxa de envio à medida que recebe confirmações, evitando congestionar a rede.
- **Congestion Avoidance**: Se o congestionamento for detectado, o TCP reduz a taxa de envio para evitar perda de pacotes.
- **Fast Retransmit e Fast Recovery**: Técnicas para retransmitir pacotes perdidos rapidamente e recuperar a taxa de envio após a detecção de congestionamento.

##Segurança no TCP

O TCP, por si só, não possui mecanismos de segurança embutidos, mas várias técnicas e protocolos são usados para proteger a comunicação TCP:

### TLS/SSL (Transport Layer Security / Secure Sockets Layer)

- **Definição**: Protocolos de segurança que operam sobre o TCP para fornecer criptografia e integridade de dados, amplamente utilizados para proteger comunicações na web (por exemplo, HTTPS).
- **Vantagens**: Protege contra ataques de interceptação, como man-in-the-middle (MitM).

### TCP Sequencing Attack (Ataque de Sequenciamento TCP)

- **Definição**: Ataques que tentam prever ou interceptar números de sequência para injetar pacotes maliciosos em uma conexão TCP.
- **Mitigação**: Uso de números de sequência aleatórios e criptografia para proteger as sessões.

## Casos de Uso do TCP

### Aplicações Web

- **HTTPS**: Protocolo de comunicação que usa TCP como base para transmitir páginas web com segurança.
- **Transferência de Arquivos (FTP)**: Usado para enviar e receber arquivos entre clientes e servidores, garantindo que todos os dados sejam transmitidos corretamente.

### E-mail

- **SMTP, IMAP, POP3**: Protocolos de e-mail que dependem do TCP para transmitir mensagens de forma confiável entre servidores de e-mail e clientes.

## Comparação entre TCP e UDP

O **TCP** e o **UDP** (User Datagram Protocol) são os dois principais protocolos de transporte, mas têm características e usos diferentes:

- **TCP**:
  - Orientado à conexão
  - Confiável (garantia de entrega, ordem e integridade dos dados)
  - Mais lento devido ao overhead de controle de conexão e confirmação
  - Usado para transmissões críticas (ex.: e-mail, transferência de arquivos)

- **UDP**:
  - Não orientado à conexão
  - Não confiável (sem garantia de entrega ou ordem dos dados)
  - Mais rápido e eficiente para aplicações que não requerem confiabilidade
  - Usado para streaming de mídia, jogos online, DNS