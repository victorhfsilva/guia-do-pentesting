# SNMP (Simple Network Management Protocol)

####  Introdução ao SNMP

**SNMP (Simple Network Management Protocol)** é um protocolo de gerenciamento de rede amplamente utilizado para monitorar e gerenciar dispositivos conectados a uma rede. Ele permite que administradores de rede coletem informações sobre o desempenho de dispositivos, monitorem falhas, configurem parâmetros e executem tarefas administrativas de maneira centralizada. Os dispositivos que suportam SNMP incluem roteadores, switches, servidores, impressoras e outros dispositivos de rede.

#### Estrutura e Componentes do SNMP

##### Componentes Principais

- **Agente SNMP**: É um software instalado nos dispositivos que serão gerenciados, como roteadores, switches e servidores. O agente coleta e armazena dados de gerenciamento e responde às consultas feitas pelo gerente.
  
- **Gerente SNMP**: Também chamado de **NMS (Network Management System)**, é o sistema que solicita informações dos agentes e os gerencia. O gerente envia consultas aos agentes e recebe respostas, além de interpretar os dados para monitorar e gerenciar a rede.

- **MIB (Management Information Base)**: Um banco de dados hierárquico que contém as informações e variáveis que podem ser consultadas ou configuradas através do SNMP. Cada dispositivo gerenciado tem uma MIB associada, contendo as informações específicas que podem ser monitoradas.

##### Objetos Gerenciados

Cada dispositivo gerenciado por SNMP possui um conjunto de objetos que podem ser monitorados ou configurados. Esses objetos são definidos na MIB e são identificados por **OIDs (Object Identifiers)**, que são números únicos que identificam variáveis específicas.

##### Operações SNMP

O SNMP suporta uma variedade de operações que permitem a comunicação entre o gerente e os agentes:

- **GET**: Solicita uma ou mais variáveis de um agente.
- **GETNEXT**: Solicita a próxima variável em uma sequência da MIB.
- **SET**: Define o valor de uma variável no agente, permitindo a configuração remota.
- **GETBULK**: Solicita grandes blocos de dados de uma vez, usado em versões mais recentes do SNMP para melhorar a eficiência.
- **TRAP**: Permite que o agente envie alertas ao gerente de maneira proativa quando ocorrem eventos importantes.
- **INFORM**: Similar ao TRAP, mas com confirmação de recebimento pelo gerente.

#### Versões do SNMP

##### SNMPv1

- **Definição**: A primeira versão do SNMP, lançada em 1988, introduziu a ideia básica de gerenciamento de rede, mas tinha limitações de segurança, usando uma única string de comunidade (`community string`) para autenticação, que era enviada em texto claro.
- **Segurança**: Extremamente limitada, com a autenticação baseada apenas na `community string`.

##### SNMPv2c

- **Definição**: Uma melhoria em relação ao SNMPv1, introduzindo novos comandos, como GETBULK, para melhorar o desempenho. Ainda assim, manteve a mesma limitação de segurança com `community strings`.
- **Segurança**: Continua limitada à autenticação básica com `community strings`, sem criptografia.

##### SNMPv3

- **Definição**: Introduziu melhorias significativas, especialmente em relação à segurança, com autenticação e criptografia de mensagens.
- **Segurança**: Autenticação de usuários, integridade de dados e criptografia para garantir que as comunicações sejam seguras. SNMPv3 é a versão recomendada para ambientes de produção por causa dessas melhorias de segurança.

#### Comunidades SNMP

As versões SNMPv1 e SNMPv2c utilizam o conceito de **strings de comunidade** para controle de acesso. As strings de comunidade atuam como senhas que definem o nível de acesso às informações dos dispositivos. Existem dois tipos de comunidades principais:

- **Read-only**: Permite apenas consultas de leitura. Um gerente pode solicitar dados dos dispositivos, mas não alterar configurações.
- **Read-write**: Permite tanto a leitura quanto a alteração de configurações em dispositivos.

Exemplo de strings de comunidade:
- **public**: Comumente usada para consultas de leitura.
- **private**: Usada para permitir leitura e escrita.

Outras strings frequentes:

- **cisco**
- **manager**
- **access**
- **secret**
- **juniper**

##### Configuração de Comunidades

Nos dispositivos gerenciados, como switches ou roteadores, as strings de comunidade devem ser configuradas. Por exemplo, em um roteador, as strings podem ser configuradas através de uma interface de linha de comando (CLI) ou por meio de uma interface de gerenciamento da web.

#### OIDs (Object Identifiers)

##### O Que é um OID?

Um **OID (Object Identifier)** é uma sequência numérica hierárquica que identifica de forma única cada objeto de gerenciamento em uma MIB. OIDs são utilizados para identificar os parâmetros que podem ser monitorados ou configurados via SNMP.

Os OIDs são representados em uma estrutura hierárquica que se assemelha a um sistema de arquivos, onde cada nível tem um significado específico. Eles podem ser usados para consultar estatísticas de tráfego, erros de interface, status do dispositivo, entre outros.

Os valores dos OIDs também podem ser consultados em `http://www.oid-info.com/`. 

#### Comandos SNMP

##### snmpget

O `snmpget` é usado para solicitar o valor de uma única variável SNMP de um dispositivo gerenciado.

**Sintaxe**:
```bash
snmpget -v 2c -c public 192.168.1.1 1.3.6.1.2.1.1.5.0
```
Neste exemplo:
- `-v 2c`: Especifica a versão do SNMP (SNMPv2c).
- `-c public`: Usa a string de comunidade `public`.
- `192.168.1.1`: Endereço IP do dispositivo gerenciado.
- `1.3.6.1.2.1.1.5.0`: OID da variável solicitada (neste caso, o nome do dispositivo).

##### snmpwalk

O `snmpwalk` é usado para listar de maneira recursiva todas as variáveis disponíveis começando em um OID específico.

**Sintaxe**:
```bash
snmpwalk -v 2c -c public 192.168.1.1 1.3.6.1.2.1.1
```
Este comando percorre todos os objetos sob o OID `1.3.6.1.2.1.1` (que contém informações gerais sobre o sistema).

##### snmpset

O `snmpset` é usado para alterar o valor de uma variável em um dispositivo gerenciado.

**Sintaxe**:
```bash
snmpset -v 2c -c private 192.168.1.1 1.3.6.1.2.1.1.6.0 s "New Location"
```
Neste exemplo, estamos alterando a localização do dispositivo (OID `1.3.6.1.2.1.1.6.0`) para "New Location".

#### Segurança no SNMP

##### Limitações de SNMPv1 e SNMPv2c

As versões SNMPv1 e SNMPv2c oferecem segurança mínima, já que as `community strings` são enviadas em texto claro pela rede, o que as torna vulneráveis a interceptações e ataques. Isso significa que qualquer pessoa que tenha acesso ao tráfego de rede pode potencialmente ler ou alterar as configurações dos dispositivos gerenciados.

##### Melhorias no SNMPv3

SNMPv3 resolve essas limitações ao introduzir autenticação, controle de acesso baseado em usuários e criptografia para proteger as comunicações. Recomenda-se a adoção do SNMPv3 para ambientes de produção devido ao seu suporte para:

- **Autenticação**: Garante que o gerente SNMP seja autenticado antes de acessar o agente.
- **Integridade de Mensagens**: Verifica se os dados não foram alterados durante o trânsito.
- **Privacidade**: Criptografa as mensagens SNMP para que os dados não possam ser interceptados.

##### Boas Práticas de Segurança

- **Use SNMPv3 Sempre que Possível**: Se o dispositivo suportar SNMPv3, configure-o para fornecer criptografia e autenticação.
- **Restrinja o Acesso às Comunidades**: Configure ACLs (Access Control Lists) para restringir quais hosts podem se comunicar com os dispositivos SNMP.
- **Evite Usar "public" e "private" como Strings de Comunidade**: Essas strings são comumente usadas e são o alvo preferido de ataques.
- **Monitorar Logs e Traps SNMP**: Acompanhe atividades suspeitas ou erros para detectar possíveis ataques ou problemas de configuração.

#### SNMP Traps

##### O Que é um

 Trap?

Um **Trap SNMP** é uma mensagem enviada proativamente por um agente SNMP a um gerente quando ocorrem eventos significativos no dispositivo (como falhas de hardware, alta utilização de CPU, etc.). Isso permite que o gerente seja informado sobre problemas sem ter que consultar o dispositivo constantemente.

##### Configuração de Traps

A configuração de traps em dispositivos depende do modelo, mas geralmente envolve especificar os destinos de trap (gerentes SNMP) e os eventos que devem gerar um trap.

##### Exemplo de Trap SNMP

Aqui está um exemplo de configuração de trap SNMP em um roteador Cisco:

```plaintext
snmp-server enable traps
snmp-server host 192.168.1.100 traps version 2c public
```
Neste exemplo, o roteador está configurado para enviar traps SNMP para o gerente com o IP `192.168.1.100`, usando a string de comunidade `public`.

#### Aplicações Comuns do SNMP

- **Monitoramento de Rede**: SNMP é amplamente utilizado para monitorar o status de dispositivos de rede, como switches, roteadores, firewalls e servidores.
- **Detecção de Falhas**: SNMP permite a detecção proativa de problemas de rede através de traps, alertando os administradores sobre falhas de hardware, saturação de tráfego, ou outros problemas críticos.
- **Coleta de Estatísticas**: SNMP é usado para coletar métricas de desempenho, como largura de banda utilizada, erros em interfaces, e tempo de atividade do sistema, ajudando na otimização da rede.