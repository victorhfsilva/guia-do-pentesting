# Protocolo ARP (Address Resolution Protocol)

## Introdução ao ARP

O **Address Resolution Protocol (ARP)** é um protocolo fundamental na rede TCP/IP que resolve endereços de rede em endereços físicos. Ele é utilizado principalmente para mapear um endereço IP (camada de rede) para um endereço MAC (camada de enlace), permitindo que a comunicação ocorra dentro de uma rede local (LAN).

## Funcionamento do ARP

O ARP opera entre as camadas de rede e de enlace de dados no Modelo OSI. Quando um dispositivo precisa se comunicar com outro na mesma rede, ele usa ARP para encontrar o endereço MAC correspondente ao endereço IP de destino.

### Processo de Resolução de Endereço

O processo básico do ARP envolve os seguintes passos:

1. **Envio de Solicitação ARP (ARP Request)**:
   - Quando um dispositivo, digamos `A`, quer enviar dados para outro dispositivo `B` na mesma rede, mas não conhece o endereço MAC de `B`, ele envia uma mensagem de solicitação ARP (ARP Request).
   - A solicitação ARP é um broadcast, ou seja, ela é enviada a todos os dispositivos na rede.
   - A mensagem contém o endereço IP de destino (`B`) e solicita que o dispositivo com esse IP responda com seu endereço MAC.

2. **Recebimento e Resposta ARP (ARP Reply)**:
   - O dispositivo `B`, ao receber a solicitação ARP, reconhece que o IP solicitado é o seu próprio e responde com uma mensagem de resposta ARP (ARP Reply).
   - A resposta ARP contém o endereço MAC de `B` e é enviada diretamente ao dispositivo `A` (unicast).

3. **Armazenamento no Cache ARP**:
   - Após receber a resposta ARP, o dispositivo `A` armazena o endereço MAC de `B` em seu cache ARP para futuras comunicações. Assim, ele não precisará enviar uma nova solicitação ARP toda vez que quiser comunicar-se com `B`.

### Estrutura de um Pacote ARP

Um pacote ARP contém os seguintes campos principais:

- **Hardware Type (HTYPE)**: Especifica o tipo de hardware. Para Ethernet, o valor é 1.
- **Protocol Type (PTYPE)**: Indica o protocolo da camada de rede. Para IPv4, o valor é 0x0800.
- **Hardware Address Length (HLEN)**: O comprimento do endereço de hardware. Para Ethernet, o valor é 6.
- **Protocol Address Length (PLEN)**: O comprimento do endereço de protocolo. Para IPv4, o valor é 4.
- **Operation (OPER)**: Especifica se o pacote é uma solicitação ARP (1) ou uma resposta ARP (2).
- **Sender Hardware Address (SHA)**: O endereço MAC do remetente.
- **Sender Protocol Address (SPA)**: O endereço IP do remetente.
- **Target Hardware Address (THA)**: O endereço MAC do destinatário (preenchido com zeros na solicitação ARP).
- **Target Protocol Address (TPA)**: O endereço IP do destinatário.

## Segurança no ARP

O ARP é vulnerável a certos tipos de ataques, principalmente porque não possui mecanismos de autenticação nativos.

### ARP Spoofing (Envenenamento ARP)

- **O que é**: O ARP Spoofing ocorre quando um atacante envia mensagens ARP falsas para associar seu endereço MAC a um endereço IP legítimo na rede. Isso permite que o atacante intercepte, modifique ou interrompa a comunicação de rede.
- **Mitigação**: As técnicas de mitigação incluem o uso de tabelas ARP estáticas, software de detecção de ARP spoofing e o uso de switches com proteção ARP (como Dynamic ARP Inspection).

## Cache ARP

O cache ARP é uma tabela mantida por cada dispositivo na rede, que armazena mapeamentos recentes de endereços IP para endereços MAC. Essa tabela é temporária e entradas antigas são removidas após um período de inatividade.

### Exibindo e Limpando o Cache ARP

- Em sistemas Windows, o comando `arp -a` exibe o cache ARP, e `arp -d` apaga uma entrada específica.
- Em sistemas Linux/Unix, o comando `ip neigh` exibe o cache ARP, e `ip neigh flush` pode ser usado para limpar entradas.
- Em sistemas linux também é possível visualizar a tabela com o comando `arp -an`.
