# Tcpdump

## Introdução

O tcpdump é uma das ferramentas de captura de pacotes mais populares e poderosas. Ele permite capturar e analisar tráfego de rede em tempo real, sendo essencial para testes de penetração e auditorias de segurança.

## Instalação

### Linux

Na maioria das distribuições Linux, o tcpdump pode ser instalado a partir dos repositórios oficiais. Por exemplo, em sistemas baseados em Debian (como Ubuntu), use:

```bash
sudo apt-get update
sudo apt-get install tcpdump
```

### macOS

No macOS, o tcpdump geralmente já vem instalado. Caso contrário, você pode usar o Homebrew:

```bash
brew install tcpdump
```

### Windows

No Windows, você pode usar o WinDump, que é a versão do tcpdump para Windows. Pode ser baixado em: [https://www.winpcap.org/windump/](https://www.winpcap.org/windump/)

## Comandos Básicos

### Sintaxe

A sintaxe básica do tcpdump é:

```bash
tcpdump [opções] [filtro]
```

### Captura Simples

Para capturar pacotes na interface padrão:

```bash
sudo tcpdump
```

### Captura em Interface Específica

Para capturar pacotes em uma interface específica (por exemplo, `eth0`):

```bash
sudo tcpdump -i eth0
```

### Salvando Capturas em Arquivo

Para salvar a captura em um arquivo para análise posterior:

```bash
sudo tcpdump -i eth0 -w captura.pcap
```

### Lendo Capturas de um Arquivo

Para ler e analisar um arquivo de captura:

```bash
sudo tcpdump -r captura.pcap
```

## Filtros Básicos

### Filtrando por Host

Para capturar pacotes de um host específico:

```bash
sudo tcpdump host 192.168.1.1
```

### Filtrando por Rede

Para capturar pacotes de uma rede específica:

```bash
sudo tcpdump net 192.168.1.0/24
```

### Filtrando por Porta

Para capturar pacotes de uma porta específica:

```bash
sudo tcpdump port 80
```

### Filtrando por Protocolo

Para capturar pacotes de um protocolo específico (por exemplo, TCP, UDP, ICMP):

```bash
sudo tcpdump tcp
sudo tcpdump udp
sudo tcpdump icmp
```

## Opções Úteis

### Captura com Mais Detalhes

Para capturar pacotes com todos os detalhes:

```bash
sudo tcpdump -vv
```

### Definindo o Número de Pacotes

Para capturar um número específico de pacotes:

```bash
sudo tcpdump -c 10
```

### Captura de Apenas Cabeçalhos

Para capturar apenas os cabeçalhos dos pacotes:

```bash
sudo tcpdump -s 0
```

### Exibindo Hora com Precisão

Para exibir timestamps com maior precisão:

```bash
sudo tcpdump -tttt
```

## Exemplos de Uso

### Analisando Tráfego HTTP

Capturar e analisar tráfego HTTP para identificar possíveis informações sensíveis:

```bash
sudo tcpdump -i eth0 -A -s 0 'tcp port 80'
```

### Monitorando Tráfego DNS

Capturar consultas DNS para identificar possíveis tentativas de exfiltração de dados:

```bash
sudo tcpdump -i eth0 'udp port 53'
```

### Analisando Tráfego de Rede Interna

Capturar tráfego interno para identificar atividades suspeitas:

```bash
sudo tcpdump -i eth0 net 192.168.1.0/24
```

## Dicas Adicionais

- **Filtragem Avançada**: Combine filtros para capturar apenas o tráfego relevante (por exemplo, `tcpdump tcp and port 80 and host 192.168.1.1`).
- **Análise Offline**: Use ferramentas como Wireshark para análise detalhada de arquivos de captura.
- **Automação**: Scripts podem ser criados para automatizar a captura e análise de pacotes.